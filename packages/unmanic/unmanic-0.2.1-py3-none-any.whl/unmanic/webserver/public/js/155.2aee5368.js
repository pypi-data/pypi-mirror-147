"use strict";(self["webpackChunkunmanic_frontend"]=self["webpackChunkunmanic_frontend"]||[]).push([[155],{155:(e,t,s)=>{s.r(t),s.d(t,{default:()=>de});var l=s(3673),o=s(2323);const a={class:"q-pa-none"},n={class:"row"},i={class:"col q-ma-sm"},r={class:"q-pa-md",style:{"max-width":"500px"}},u={class:"q-mb-none"},d={class:"q-gutter-sm"},c={class:"q-mb-none"},h={class:"q-gutter-sm"},m={class:"text-weight-bold"},p={class:"text-weight-bold"},w={class:"text-grey-8 q-gutter-xs"},k={class:"text-h6"},g={class:"row items-center justify-end"},b={class:"q-mb-none"},f={class:"q-gutter-sm"},_={key:0},y={class:"row"},v={class:"col-6 text-center"},q={class:"col-6 text-center"};function W(e,t,s,W,$,C){const T=(0,l.up)("q-skeleton"),x=(0,l.up)("q-input"),V=(0,l.up)("q-slider"),L=(0,l.up)("q-separator"),Q=(0,l.up)("q-tooltip"),Z=(0,l.up)("q-icon"),S=(0,l.up)("q-avatar"),P=(0,l.up)("q-item-section"),U=(0,l.up)("q-item-label"),z=(0,l.up)("q-btn"),j=(0,l.up)("q-item"),O=(0,l.up)("draggable"),H=(0,l.up)("q-list"),D=(0,l.up)("q-space"),I=(0,l.up)("q-bar"),B=(0,l.up)("q-card-section"),E=(0,l.up)("q-select"),A=(0,l.up)("q-time"),F=(0,l.up)("q-popup-proxy"),J=(0,l.up)("q-card-actions"),N=(0,l.up)("q-card"),G=(0,l.up)("q-dialog"),K=(0,l.up)("q-form"),M=(0,l.up)("q-page"),R=(0,l.Q2)("close-popup");return(0,l.wg)(),(0,l.j4)(M,{padding:""},{default:(0,l.w5)((()=>[(0,l._)("div",a,[(0,l._)("div",n,[(0,l._)("div",i,[(0,l._)("div",r,[(0,l.Wm)(K,{onSubmit:C.save,class:"q-gutter-md"},{default:(0,l.w5)((()=>[(0,l._)("h5",u,(0,o.zw)(e.$t("components.settings.workers.workerCount")),1),(0,l._)("div",d,[null===$.workerCount?((0,l.wg)(),(0,l.j4)(T,{key:0,type:"QInput"})):(0,l.kq)("",!0),null!==$.workerCount?((0,l.wg)(),(0,l.j4)(x,{key:1,readonly:"",outlined:"",color:"primary",modelValue:$.workerCount,"onUpdate:modelValue":t[0]||(t[0]=e=>$.workerCount=e),label:e.$t("components.settings.workers.workerCount"),placeholder:$.workerCount},null,8,["modelValue","label","placeholder"])):(0,l.kq)("",!0),null===$.workerCount?((0,l.wg)(),(0,l.j4)(T,{key:2,type:"QSlider"})):(0,l.kq)("",!0),null!==$.workerCount?((0,l.wg)(),(0,l.j4)(V,{key:3,modelValue:$.workerCount,"onUpdate:modelValue":t[1]||(t[1]=e=>$.workerCount=e),min:0,max:12,color:"primary"},null,8,["modelValue"])):(0,l.kq)("",!0)]),(0,l.Wm)(L,{class:"q-my-lg"}),(0,l._)("h5",c,(0,o.zw)(e.$t("components.settings.workers.schedule")),1),(0,l._)("div",h,[null===$.cachePath?((0,l.wg)(),(0,l.j4)(T,{key:0,type:"text"})):(0,l.kq)("",!0),(0,l.Wm)(H,{bordered:"",separator:"",class:"rounded-borders"},{default:(0,l.w5)((()=>[(0,l.Wm)(O,(0,l.dG)({class:"schedule-list-group","item-key":"order",tag:"transition-group","component-data":{tag:"ul",name:"flip-list",type:"transition"},modelValue:$.schedules,"onUpdate:modelValue":t[2]||(t[2]=e=>$.schedules=e)},C.dragOptions),{item:(0,l.w5)((({element:t,index:s})=>[((0,l.wg)(),(0,l.j4)(j,{key:s,class:"q-pa-none rounded-borders","active-class":"schedule-list-item"},{default:(0,l.w5)((()=>[(0,l.Wm)(P,{avatar:"",class:"q-px-sm q-mx-sm"},{default:(0,l.w5)((()=>[(0,l.Wm)(S,{rounded:""},{default:(0,l.w5)((()=>[(0,l.Wm)(Z,{name:"drag_handle",class:"",style:{"max-width":"30px"}},{default:(0,l.w5)((()=>[(0,l.Wm)(Q,{class:"bg-white text-primary"},{default:(0,l.w5)((()=>[(0,l.Uk)((0,o.zw)(e.$t("tooltips.move")),1)])),_:1})])),_:1})])),_:1})])),_:1}),(0,l.Wm)(L,{inset:"",vertical:"",class:"q-mr-sm"}),(0,l.Wm)(P,{class:"q-px-sm q-mx-sm"},{default:(0,l.w5)((()=>[(0,l.Wm)(U,{lines:"1"},{default:(0,l.w5)((()=>[(0,l.Uk)((0,o.zw)(t.repetitionLabel)+" @ "+(0,o.zw)(t.scheduleTime),1)])),_:2},1024),"count"===t.scheduleTask?((0,l.wg)(),(0,l.j4)(U,{key:0,caption:"",lines:"2"},{default:(0,l.w5)((()=>[(0,l._)("span",m,(0,o.zw)(t.scheduleTaskLabel),1),(0,l.Uk)(" = "+(0,o.zw)(t.scheduleWorkerCount),1)])),_:2},1024)):((0,l.wg)(),(0,l.j4)(U,{key:1,caption:"",lines:"2"},{default:(0,l.w5)((()=>[(0,l._)("span",p,(0,o.zw)(t.scheduleTaskLabel),1)])),_:2},1024))])),_:2},1024),(0,l.Wm)(L,{inset:"",vertical:"",class:"q-mx-sm"}),(0,l.Wm)(P,{center:"",side:""},{default:(0,l.w5)((()=>[(0,l._)("div",w,[(0,l.Wm)(z,{flat:"",dense:"",round:"",size:"12px",color:"negative",icon:"delete",onClick:e=>C.deleteSchedule(s)},{default:(0,l.w5)((()=>[(0,l.Wm)(Q,{class:"bg-white text-primary"},{default:(0,l.w5)((()=>[(0,l.Uk)((0,o.zw)(e.$t("tooltips.delete")),1)])),_:1})])),_:2},1032,["onClick"])])])),_:2},1024)])),_:2},1024))])),_:1},16,["modelValue"])])),_:1}),(0,l.Wm)(I,{class:"bg-transparent"},{default:(0,l.w5)((()=>[(0,l.Wm)(D),(0,l.Wm)(z,{round:"",flat:"",color:"primary",icon:"add",onClick:t[3]||(t[3]=e=>$.newSchedule=!0)},{default:(0,l.w5)((()=>[(0,l.Wm)(Q,{class:"bg-white text-primary"},{default:(0,l.w5)((()=>[(0,l.Uk)((0,o.zw)(e.$t("tooltips.add")),1)])),_:1})])),_:1})])),_:1}),(0,l.Wm)(G,{modelValue:$.newSchedule,"onUpdate:modelValue":t[9]||(t[9]=e=>$.newSchedule=e),persistent:""},{default:(0,l.w5)((()=>[(0,l.Wm)(N,{style:{"min-width":"350px"}},{default:(0,l.w5)((()=>[(0,l.Wm)(B,null,{default:(0,l.w5)((()=>[(0,l._)("div",k,(0,o.zw)(e.$t("components.settings.workers.newScheduledEvent")),1)])),_:1}),(0,l.Wm)(B,{class:"q-pt-none"},{default:(0,l.w5)((()=>[(0,l.Wm)(E,{filled:"",modelValue:$.repetition,"onUpdate:modelValue":t[4]||(t[4]=e=>$.repetition=e),options:$.repetitionOptions,label:e.$t("components.settings.workers.repetition")},null,8,["modelValue","options","label"])])),_:1}),(0,l.Wm)(B,{class:"q-pt-none"},{default:(0,l.w5)((()=>[(0,l.Wm)(x,{filled:"",modelValue:$.scheduleTime,"onUpdate:modelValue":t[6]||(t[6]=e=>$.scheduleTime=e),mask:"time"},{append:(0,l.w5)((()=>[(0,l.Wm)(Z,{name:"access_time",class:"cursor-pointer"},{default:(0,l.w5)((()=>[(0,l.Wm)(F,{"transition-show":"scale","transition-hide":"scale"},{default:(0,l.w5)((()=>[(0,l.Wm)(A,{modelValue:$.scheduleTime,"onUpdate:modelValue":t[5]||(t[5]=e=>$.scheduleTime=e)},{default:(0,l.w5)((()=>[(0,l._)("div",g,[(0,l.wy)((0,l.Wm)(z,{label:e.$t("navigation.close"),color:"primary",flat:""},null,8,["label"]),[[R]])])])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1}),(0,l.Wm)(B,{class:"q-pt-none"},{default:(0,l.w5)((()=>[(0,l.Wm)(E,{filled:"",modelValue:$.scheduleTask,"onUpdate:modelValue":t[7]||(t[7]=e=>$.scheduleTask=e),options:$.scheduleTaskOptions,label:e.$t("components.settings.workers.task")},null,8,["modelValue","options","label"])])),_:1}),"count"===$.scheduleTask.value?((0,l.wg)(),(0,l.j4)(B,{key:0,class:"q-pt-none q-mt-md q-mx-md"},{default:(0,l.w5)((()=>[(0,l.Wm)(V,{modelValue:$.scheduleWorkerCount,"onUpdate:modelValue":t[8]||(t[8]=e=>$.scheduleWorkerCount=e),min:0,max:12,label:"","label-value":"Worker count: "+$.scheduleWorkerCount,"label-always":"",color:"primary"},null,8,["modelValue","label-value"])])),_:1})):(0,l.kq)("",!0),(0,l.Wm)(J,{align:"right",class:"text-primary"},{default:(0,l.w5)((()=>[(0,l.wy)((0,l.Wm)(z,{flat:"",label:e.$t("navigation.cancel")},null,8,["label"]),[[R]]),(0,l.wy)((0,l.Wm)(z,{onClick:C.addNewScheduledEvent,flat:"",label:e.$t("components.settings.workers.addEvent")},null,8,["onClick","label"]),[[R]])])),_:1})])),_:1})])),_:1},8,["modelValue"])]),(0,l.Wm)(L,{class:"q-my-lg"}),(0,l._)("h5",b,(0,o.zw)(e.$t("components.settings.workers.path")),1),(0,l._)("div",f,[null===$.cachePath?((0,l.wg)(),(0,l.j4)(T,{key:0,type:"QInput"})):((0,l.wg)(),(0,l.j4)(x,{key:1,readonly:"",outlined:"",color:"primary",modelValue:$.cachePath,"onUpdate:modelValue":t[10]||(t[10]=e=>$.cachePath=e),label:e.$t("components.settings.workers.path"),placeholder:$.cachePath,onClick:C.updateLibraryWithDirectoryBrowser},{append:(0,l.w5)((()=>[(0,l.Wm)(Z,{onClick:C.updateLibraryWithDirectoryBrowser,class:"cursor-pointer",name:"folder_open"},null,8,["onClick"])])),_:1},8,["modelValue","label","placeholder","onClick"]))]),(0,l._)("div",null,[(0,l.Wm)(z,{label:e.$t("navigation.submit"),type:"submit",color:"secondary"},null,8,["label"])])])),_:1},8,["onSubmit"])])])]),e.$q.platform.is.mobile?((0,l.wg)(),(0,l.iD)("div",_,[(0,l.Wm)(L,{class:"q-mb-lg"}),(0,l._)("div",y,[(0,l._)("div",v,[(0,l.Wm)(N,{flat:"",bordered:"",onClick:t[11]||(t[11]=t=>e.$router.push("/ui/settings-library")),class:"q-ma-xs"},{default:(0,l.w5)((()=>[(0,l.Wm)(z,{icon:"navigate_before",flat:""},{default:(0,l.w5)((()=>[(0,l.Uk)((0,o.zw)(e.$t("navigation.library")),1)])),_:1})])),_:1})]),(0,l._)("div",q,[(0,l.Wm)(N,{flat:"",bordered:"",onClick:t[12]||(t[12]=t=>e.$router.push("/ui/settings-plugins")),class:"q-ma-xs"},{default:(0,l.w5)((()=>[(0,l.Wm)(z,{"icon-right":"navigate_next",flat:""},{default:(0,l.w5)((()=>[(0,l.Uk)((0,o.zw)(e.$t("navigation.plugins")),1)])),_:1})])),_:1})])])])):(0,l.kq)("",!0)])])),_:1})}var $=s(4190),C=s(1959),T=s(8825),x=s(5948),V=s(5625),L=s(52),Q=s.n(L),Z=s(470),S=s.n(Z),P=s(7689);const U={name:"SettingsWorkers",components:{draggable:S()},setup(){(0,T.Z)();const{t:e}=(0,x.QT)();let t=null,s=(0,$.A)(e);function o(){t=s.init()}function a(){s.close()}(0,l.bv)((()=>{o()})),(0,l.Ah)((()=>{a()}))},data(){return{workerCount:(0,C.iH)(null),cachePath:(0,C.iH)(null),schedules:(0,C.iH)([]),newSchedule:(0,C.iH)(!1),repetition:(0,C.iH)(""),repetitionOptions:[{label:this.$t("components.settings.workers.scheduleLabels.daily"),value:"daily"},{label:this.$t("components.settings.workers.scheduleLabels.weekday"),value:"weekday"},{label:this.$t("components.settings.workers.scheduleLabels.weekend"),value:"weekend"},{label:this.$t("components.settings.workers.scheduleLabels.monday"),value:"monday"},{label:this.$t("components.settings.workers.scheduleLabels.tuesday"),value:"tuesday"},{label:this.$t("components.settings.workers.scheduleLabels.wednesday"),value:"wednesday"},{label:this.$t("components.settings.workers.scheduleLabels.thursday"),value:"thursday"},{label:this.$t("components.settings.workers.scheduleLabels.friday"),value:"friday"},{label:this.$t("components.settings.workers.scheduleLabels.saturday"),value:"saturday"},{label:this.$t("components.settings.workers.scheduleLabels.sunday"),value:"sunday"}],scheduleTime:(0,C.iH)("00:00"),scheduleTask:(0,C.iH)(""),scheduleTaskOptions:[{label:this.$t("components.settings.workers.scheduleLabels.count"),value:"count"},{label:this.$t("components.settings.workers.scheduleLabels.pause"),value:"pause"},{label:this.$t("components.settings.workers.scheduleLabels.resume"),value:"resume"}],scheduleWorkerCount:(0,C.iH)(1)}},methods:{updateLibraryWithDirectoryBrowser:function(){this.$q.dialog({component:V.Z,componentProps:{dialogHeader:this.$t("headers.selectDirectory"),initialPath:this.cachePath,listType:"directories"}}).onOk((e=>{"undefined"!==typeof e.selectedPath&&null!==e.selectedPath&&(this.cachePath=e.selectedPath)})).onDismiss((()=>{}))},fetchSettings:function(){Q()({method:"get",url:(0,P.J4)("v2","settings/read")}).then((e=>{this.workerCount=e.data.settings.number_of_workers;let t=[];for(let s=0;s<e.data.settings.worker_event_schedules.length;s++){let l=e.data.settings.worker_event_schedules[s];t[t.length]={repetition:l.repetition,repetitionLabel:this.$t("components.settings.workers.scheduleLabels."+l.repetition),scheduleTime:l.schedule_time,scheduleTask:l.schedule_task,scheduleTaskLabel:this.$t("components.settings.workers.scheduleLabels."+l.schedule_task),scheduleWorkerCount:l.schedule_worker_count}}this.schedules=t,this.cachePath=e.data.settings.cache_path})).catch((()=>{this.$q.notify({color:"negative",position:"top",message:this.$t("notifications.failedToFetchSettings"),icon:"report_problem",actions:[{icon:"close",color:"white"}]})}))},save:function(){let e=[];for(let s=0;s<this.schedules.length;s++)e[e.length]={repetition:this.schedules[s].repetition,schedule_time:this.schedules[s].scheduleTime,schedule_task:this.schedules[s].scheduleTask,schedule_worker_count:this.schedules[s].scheduleWorkerCount};let t={settings:{number_of_workers:this.workerCount,cache_path:this.cachePath,worker_event_schedules:e}};Q()({method:"post",url:(0,P.J4)("v2","settings/write"),data:t}).then((e=>{this.fetchSettings(),this.$q.notify({color:"positive",position:"top",icon:"cloud_done",message:this.$t("notifications.saved"),timeout:200})})).catch((()=>{this.$q.notify({color:"negative",position:"top",message:this.$t("notifications.failedToSaveSettings"),icon:"report_problem",actions:[{icon:"close",color:"white"}]})}))},addNewScheduledEvent:function(){"undefined"!==typeof this.repetition.value&&"undefined"!==typeof this.scheduleTask.value?this.schedules[this.schedules.length]={repetition:this.repetition.value,repetitionLabel:this.$t("components.settings.workers.scheduleLabels."+this.repetition.value),scheduleTime:this.scheduleTime,scheduleTask:this.scheduleTask.value,scheduleTaskLabel:this.$t("components.settings.workers.scheduleLabels."+this.scheduleTask.value),scheduleWorkerCount:this.scheduleWorkerCount}:this.$q.notify({color:"negative",position:"top",message:this.$t("notifications.invalidWorkerEvent"),icon:"report_problem",actions:[{icon:"close",color:"white"}]})},deleteSchedule:function(e){let t=[];for(let s=0;s<this.schedules.length;s++)s!==e&&(t[t.length]=this.schedules[s]);this.schedules=t}},created(){this.fetchSettings()},computed:{dragOptions(){return{animation:100,group:"scheduleOrder",disabled:!1,ghostClass:"ghost",direction:"vertical",delay:200,delayOnTouchOnly:!0}}}};var z=s(4260),j=s(4379),O=s(5269),H=s(4103),D=s(4842),I=s(2064),B=s(5869),E=s(7011),A=s(3414),F=s(2035),J=s(5096),N=s(4554),G=s(8870),K=s(2350),M=s(2165),R=s(846),X=s(2025),Y=s(6778),ee=s(151),te=s(5589),se=s(8516),le=s(3944),oe=s(7886),ae=s(9367),ne=s(677),ie=s(7518),re=s.n(ie);const ue=(0,z.Z)(U,[["render",W]]),de=ue;re()(U,"components",{QPage:j.Z,QForm:O.Z,QSkeleton:H.ZP,QInput:D.Z,QSlider:I.Z,QSeparator:B.Z,QList:E.Z,QItem:A.Z,QItemSection:F.Z,QAvatar:J.Z,QIcon:N.Z,QTooltip:G.Z,QItemLabel:K.Z,QBtn:M.Z,QBar:R.Z,QSpace:X.Z,QDialog:Y.Z,QCard:ee.Z,QCardSection:te.Z,QSelect:se.Z,QPopupProxy:le.Z,QTime:oe.Z,QCardActions:ae.Z}),re()(U,"directives",{ClosePopup:ne.Z})}}]);