(self.webpackChunk_jlab_enhanced_recents=self.webpackChunk_jlab_enhanced_recents||[]).push([[568],{568:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>m});var s,c,a,i,r=n(294),o=n(455),h=n(170),l=n(945),u=n(168),d=n(706);!function(e){e.recents="jupyterlab-recents"}(s||(s={})),function(e){e.recents=`${s}:recents`}(c||(c={})),function(e){e.openRecent=`${s.recents}:open-recent`,e.clearRecents=`${s.recents}:clear-recents`}(a||(a={})),function(e){e.mergePaths=function(e,t){return e.endsWith("/")&&(e=e.slice(0,-1)),t.endsWith("/")&&(t=t.slice(1)),`${e}/${t}`}}(i||(i={}));class p{constructor(e,t,n){this.recentsChanged=new u.Signal(this),this.awaitingSaveCompletion=!1,this.serverRoot=r.PageConfig.getOption("serverRoot"),this.stateDB=t,this.contentsManager=n,this.recentsMenu=new d.Menu({commands:e}),this.recentsMenu.title.label="Recents",this.recentsChanged.connect((e=>{this.syncRecentsMenu()}))}get recents(){return(this._recents||[]).filter((e=>e.root===this.serverRoot))}set recents(e){const t=this._recents.filter((e=>e.root!==this.serverRoot)),n=e.filter((e=>e.root===this.serverRoot)).concat(t);this._recents=n,this.saveRecents(),this.recentsChanged.emit(this.recents)}async init(){return await this.loadRecents(),this.validateRecents()}addRecent(e,t){const n={root:this.serverRoot,path:e,contentType:t},s=this.recents,c=s.filter((e=>"directory"===e.contentType)),a=s.filter((e=>"directory"!==e.contentType)),i="directory"===t?c:a,r=i.findIndex((t=>t.path===e));r>=0&&i.splice(r,1),i.unshift(n),i.length>10&&i.pop(),this.recents=c.concat(a)}removeRecents(e){const t=this.recents;this.recents=t.filter((t=>-1===e.indexOf(t.path)))}clearRecents(){this.recents=[]}async validateRecents(){clearTimeout(this.validator),this.validator=setTimeout(this.validateRecents.bind(this),12e3);const e=this.recents,t=(await Promise.all(e.map((async e=>{try{return await this.contentsManager.get(e.path,{content:!1}),null}catch(t){if(404===t.response.status)return e.path}})))).filter((e=>null!==e));t.length>0&&this.removeRecents(t)}syncRecentsMenu(){this.recentsMenu.clearItems();const e=this.recents,t=e.filter((e=>"directory"!==e.contentType));[e.filter((e=>"directory"===e.contentType)),t].forEach((e=>{e.length>0&&(e.forEach((e=>{this.recentsMenu.addItem({command:a.openRecent,args:{recent:e}})})),this.recentsMenu.addItem({type:"separator"}))})),this.recentsMenu.addItem({command:a.clearRecents})}async loadRecents(){const e=await this.stateDB.fetch(c.recents);this._recents=e||[],this.recentsChanged.emit(this.recents)}saveRecents(){clearTimeout(this.saveRoutine),this.saveRoutine=setTimeout((async()=>{if(this.awaitingSaveCompletion)this.saveRecents();else{this.awaitingSaveCompletion=!0;try{await this.stateDB.save(c.recents,this._recents),this.awaitingSaveCompletion=!1}catch(e){this.awaitingSaveCompletion=!1,console.log("Saving recents failed"),this.saveRecents()}}}),500)}}const m={id:s.recents,autoStart:!0,requires:[l.IStateDB,h.IMainMenu,o.IDocumentManager],activate:(e,t,n,s)=>{console.log("JupyterLab extension jupyterlab-recents is activated!");const{commands:c,serviceManager:r}=e,o=new p(c,t,r.contents);s.activateRequested.connect((async(t,n)=>{const c=await s.services.contents.get(n,{content:!1}),a=e.docRegistry.getFileTypeForModel(c).contentType;if(o.addRecent(n,a),"directory"!==a){const e=n.lastIndexOf("/")>0?n.slice(0,n.lastIndexOf("/")):"";o.addRecent(e,"directory")}})),c.addCommand(a.openRecent,{execute:async e=>{const t=e.recent,n=""===t.path?"/":t.path;return await c.execute("filebrowser:open-path",{path:n}),o.validateRecents()},label:e=>{const t=e.recent;return i.mergePaths(t.root,t.path)}}),c.addCommand(a.clearRecents,{execute:()=>o.clearRecents(),label:()=>"Clear Recents"}),n.fileMenu.addGroup([{type:"submenu",submenu:o.recentsMenu}],1);try{const e=n.fileMenu._groups;let t=0,s=-1;for(let n=0;n<e.length;n++)1===e[n].rank&&(t+=1,s<0&&(s=n));if(2===t){const t=e[s];t.size=t.size+1,e.splice(s+1,1);const c=n.fileMenu.menu,a=c._items;let i=!1;for(let e=a.length-1;e>0;e--){const t=a[e];if("filebrowser:open-path"===t.command)break;i&&"separator"===t.type?c.removeItemAt(e):"submenu"===t.type&&"Recents"===t.submenu.title.label&&(i=!0)}}}catch(e){console.debug(e)}o.init()}}}}]);