<!DOCTYPE html>
<html>

<head lang="en">
    <meta charset="UTF-8">
    <style>
		body {
		    margin: 2rem;
		}
		
		h2 {
		    border-bottom: 1px solid #b3c0c8;
		}
		h3 {
		    border-bottom: 5px solid #f5f1ff;
		}        
		
		#footer {
		    margin-top: 4rem;
		    color: gray;
		    border-top: 2px solid #ddd;
		    text-align: center;
		}
		
		code {
		    color: green;
		}
		
		.info-icon {
		    float: right;
		    background-color: #3175f7;
		    width: 1.0rem;
		    height: 1rem;
		    padding: 0.1rem;
		    text-align: center;
		    padding-bottom: 0rem;
		    color: white;
		    font-weight: bold;
		    border-radius: 1rem;
		    line-height: 11pt;
		    cursor: pointer;
		}
		.info-line {
		    width: 100%;
		    background-color: whitesmoke;
		    padding: 1rem;
		    margin: 1rem;
		    margin-left: -1rem;
		    font-size: 10pt;
		}
		
		.optional {
		    margin: 1rem;
		    border: 1px dotted #375fd4;
		    padding: 1rem;
		    background-color: #e6efff;
		}
		
		.annotation {
		    margin: 0.3rem;
		    padding: 0.3rem;
		}
		  
		label {
		    margin-left: 0.3rem;
		    margin-right: 0.3rem;
		}
		
		.hide {
		    display: none
		}
		
		.spacer-1 {
		    margin: 0rem;
		    padding:0rem;
		}
		.spacer-2 {
		    margin: 0rem;
		    padding:0rem;
		}
		.spacer-3 {
		    margin: 0rem;
		    padding:0rem;
		}
		.spacer-4 {
		    margin: 0rem;
		    padding:0rem;
		}
		.flex-row {
		    display: flex;
		    flex-direction: row;
		    margin-bottom: 0.5rem;
		}
		.flex-row>.annotation {
		    flex: 4;
		}
		.flex-row>div.label {
		    flex: 1;
		}
		.flex-row>.spacer-1 {
		    flex: 1;
		}  
		.flex-row>.spacer-2 {
		    flex: 2;
		}  
		.flex-row>.spacer-3 {
		    flex: 3;
		}  
		.flex-row>.spacer-4 {
		    flex: 4;
		}                                
		.flex-row>input {
		    flex: auto;
		}        
		.flex-row>button {
		    flex: 1;
		} 
		#pywebview-status {
		    position: absolute;
		    top: 0rem;
		    right: 1rem;
		}
		
		#response-container {
		    display: none;
		    padding: 3rem;
		    margin: 3rem 5rem;
		    font-size: 12pt;
		    border: 5px dashed #ccc;
		}
		
		.code-0 {
		    color: gray
		}
		
		.code-405 {
		    color: rgb(237, 10, 10);
		
		}
		
		.code-500 {
		    color: rgb(237, 10, 10);
		    font-weight: bold;
		}
		
		.code-500::before {
		    content: 'Internal Error: ';
		}
		
		.blink_me {
		    animation: blinker 1s linear infinite;
		}
		
		@keyframes blinker {
		    50% {
		        opacity: 0;
		        color: rgb(237, 10, 10);
		    }
		}
		
		.done {
		    background-color: #e9ffdf;
		    color: #14440a;
		    border: 1px dotted #248a07;
		}
		.action-link {
		    color: blue;
		    text-decoration: underline;
		    cursor: pointer;
		}
		
		button {
		    font-size: 10pt;
		    margin: 0.3rem;
		    background-color: #0a365d;
		    border: 0px solid #fff;
		    color: white;
		    font-weight: normal;
		    border-radius: 0.4rem;
		    cursor: pointer;
		}
		.bottom {
		    margin-left: -2rem;
		    width: calc(100vw);
		    position: fixed;
		    bottom: -0.3rem;
		    border-top: 1px solid #9090a4;
		}    
		
		#footer button {
		    padding: 1rem;
		    display: block;
		    width: 100%;
		    border-radius: 0;
		    padding-top: 0.3rem;
		    padding-bottom: 0.3rem;
		    background-color: #c8c8d9;
		    color: #191d59;
		}
		#footer button.bottom {
		    padding: 0.5rem;
		}
		
		#footer button.done {
		    background-color: #e0eeb9;
		    color: #14440a;
		}
		div.done button {
		    background-color: #bae5ab;
		    color: #14440a;
		}
		
		

	</style>
    <script>
        let WINDOW_ID = 'self'
    </script>    
</head>

<body>


    <h1>Obsidian-HTML GUI</h1>
    <p id='pywebview-status'><span class="blink_me">Initializing...</span></p>

    <h2>Setup</h2>
    <ul>
        <li>
            <a class="action-link" onclick="LaunchSetupObsidianHtml()">
                Setup Obsidian-HTML
            </a>
        </li>
        <li>
            <a class="action-link" onclick="LaunchSettingsOverview()">
                View configured settings
            </a>
        </li>        
    </ul>

    <h2>Wizards</h2>
    <ul>
        <li>
            <a class="action-link" onclick="LaunchVaultGithubPagesInstaller()">
                Setup Github Pages Publishing.
            </a>
        </li>
    </ul>

    <h2>Quicklinks</h2>
    <ul>
        <li>
            <a class="action-link" onclick="temp_SetupGitpages()">
                Setup gitpages.
            </a>
        </li>
    </ul>
    


    <div id="response-container"></div>

    <div id="footer" style="border: none;">
        <button class="action bottom" id="exit-button" onClick="api('close', {'window_id': WINDOW_ID}, 'outnull')">Close</button>
    </div>

    <script>
		// HTML Functions
		// -----------------------------------------------------------------------
		function toggle(id) {
		    let cont = document.getElementById(id)
		    if (cont.style.display == 'none') {
		        cont.style.display = 'block'
		    } else {
		        cont.style.display = 'none'
		    }
		}
		
		function set_form_status(done) {
		    let el = document.getElementById("exit-button")
		    if (el) {
		        if (done) {
		            el.classList.add("done");
		        } else {
		            el.classList.remove("done");
		        }
		    }
		}
		
		function span_wrap(msg, code) {
		    return '<span class="code-' + code + '">' + msg + '</span>'
		}
		
		// API
		// -----------------------------------------------------------------------
		function api(method, args, resultdiv_id) {
		    action = showResponseEnclosure(resultdiv_id)
		    pywebview.api.call(method, args).then(action).catch(action)
		}
		function showResponseEnclosure(resultdiv_id) {
		    return function(response) {
		        showResponse(response, resultdiv_id)
		    }
		}
		function showResponse(args) {
		    //alert(args)
		    var container = document.getElementById(args.result_div_id)
		
		    if (args.code == null){
		        code = 500
		    } else {
		        code = args.code
		    }
		    container.innerHTML = '<span class="code-' + code + '">' + args.message + '</span>'
		    container.style.display = 'block'
		}


        // On load
        // -----------------------------------------------------------------------
        //let nIntervId;
        window.addEventListener('pywebviewready', function() {
            var container = document.getElementById('pywebview-status')
            container.innerHTML = '<span style="color:green">GUI initialized</span>'

            //intervalID = setInterval(test, 500);
            getVersion()
        })

        // Page specific
        // -----------------------------------------------------------------------        
        function LaunchSettingsOverview() {
            pywebview.api.LaunchSettingsOverview().then(showResponse).catch(showResponse)
        }
        function LaunchSetupObsidianHtml() {
            pywebview.api.LaunchSetupObsidianHtml().then(showResponse).catch(showResponse)
        }        

        function test() {
            pywebview.api.test().then(showResponse).catch(showResponse)
        }

        function temp_SetupGitpages() {
            pywebview.api.temp_SetupGitpages().then(showResponse).catch(showResponse)
        }

        function getVersion() {
            pywebview.api.getVersion().then(showResponse)
        }

        function LaunchVaultGithubPagesInstaller() {
            pywebview.api.LaunchVaultGithubPagesInstaller().then(showResponse).catch(showResponse)
        }

        function getLocalPath() {
            pywebview.api.pickFile().then(showResponse)
        }

        function catchException() {
            pywebview.api.error().catch(showResponse)
        }
    </script>
</body>

</html>