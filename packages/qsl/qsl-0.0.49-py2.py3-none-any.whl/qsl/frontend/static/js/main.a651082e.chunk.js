(this.webpackJsonpqsl=this.webpackJsonpqsl||[]).push([[0],{197:function(e,t,n){"use strict";n.r(t);var a=n(0),c=n.n(a),i=n(54),r=n.n(i),o=n(5),l=n(74),s=n(117),u=n(21),j=n(24),b=n(7),d=n(47),h=n.n(d),f=n(65),O=n(4),x=n(18),g=n(199),m=n(270),p=n(119),v=n(108),y=n(63),C=n(71),S=n(257),k=n(214),w=n(62),B=n(258),I=n(208),N=n(266),E=n(135),L=n(271),P=n(2),A=function(e){return Object(P.jsx)(g.a,{value:e.optionName,control:e.control,label:"".concat(e.optionName," (").concat(e.optionConfig.shortcut,")")})},R=function(e){var t=a.useState(""),n=Object(o.a)(t,2),c=n[0],i=n[1],r=a.useState("single"),l=Object(o.a)(r,2),s=l[0],u=l[1];return Object(P.jsxs)(m.a,{container:!0,spacing:3,children:[Object(P.jsx)(m.a,{item:!0,xs:6,children:Object(P.jsx)(p.a,{value:c,placeholder:"New label name",onChange:function(e){return i(e.target.value)},style:{width:"100%"}})}),Object(P.jsx)(m.a,{item:!0,xs:3,children:Object(P.jsxs)(v.a,{labelId:"config-type-selector",id:"config-type-selector",label:"New label type",value:s,onChange:function(e){return u(e.target.value)},style:{width:"100%"},children:[Object(P.jsx)(y.a,{value:"single",children:"Single"}),Object(P.jsx)(y.a,{value:"multiple",children:"Multiple"}),Object(P.jsx)(y.a,{value:"text",children:"Text"})]})}),Object(P.jsx)(m.a,{item:!0,xs:3,children:Object(P.jsx)(C.a,{variant:"contained",color:"primary",onClick:function(){e.addConfig(c,s),i("")},style:{width:"100%"},disabled:!c||e.configGroup[s].hasOwnProperty(c),children:"Add Label"})})]})},T=function(e){var t=a.useState(""),n=Object(o.a)(t,2),c=n[0],i=n[1],r=a.useState(""),l=Object(o.a)(r,2),s=l[0],u=l[1];return Object(P.jsxs)(S.a,{style:{marginBottom:"10px"},children:[Object(P.jsx)(p.a,{value:c,onChange:function(e){return i(e.target.value)},placeholder:"New option name",style:{marginRight:"10px"}}),Object(P.jsx)(p.a,{value:s,onChange:function(e){return u(e.target.value)},placeholder:"Keyboard shortcut",style:{marginRight:"10px"}}),Object(P.jsx)(C.a,{disabled:0===c.length||1!==s.length||!e.isShortcutValid(c,s),variant:"contained",color:"primary",onClick:function(){e.addOption(c,s),i(""),u("")},children:"Add Option"})]})},M=function(e){return Object(P.jsxs)(k.a,{children:[Object(P.jsx)(w.a,{component:"fieldset",children:Object(P.jsxs)(B.a,{"aria-label":e.configName,name:e.configName,value:e.selected,children:[Object(P.jsx)(I.a,{component:"legend",children:e.configName}),Object.entries(e.config.options).map((function(t){var n=Object(o.a)(t,2),a=n[0],c=n[1];return Object(P.jsx)(A,{optionName:a,optionConfig:c,control:Object(P.jsx)(N.a,{disabled:!e.onChange,onClick:function(t){return e.onChange(t,t.target.value)}})},a)}))]})}),e.setConfig?Object(P.jsx)(T,{isShortcutValid:e.isShortcutValid,addOption:function(t,n){return e.setConfig(e.configName,Object(O.a)(Object(O.a)({},e.config),{},{options:Object(O.a)(Object(O.a)({},e.config.options),{},Object(b.a)({},t,{shortcut:n,id:null}))}))}}):null]})},D=function(e){return Object(P.jsxs)("div",{children:[Object(P.jsx)(k.a,{children:Object(P.jsxs)(w.a,{component:"fieldset",children:[Object(P.jsx)(I.a,{component:"legend",children:e.configName}),Object.entries(e.config.options).map((function(t){var n=Object(o.a)(t,2),a=n[0],c=n[1];return Object(P.jsx)(A,{optionName:a,optionConfig:c,control:Object(P.jsx)(E.a,{disabled:!e.onChange,checked:!!e.selected&&e.selected.indexOf(a)>=0,onChange:function(t){return e.onChange(t,a)},name:a})},a)}))]})}),e.setConfig?Object(P.jsx)(T,{isShortcutValid:e.isShortcutValid,addOption:function(t,n){return e.setConfig(e.configName,Object(O.a)(Object(O.a)({},e.config),{},{options:Object(O.a)(Object(O.a)({},e.config.options),{},Object(b.a)({},t,{shortcut:n,id:null}))}))}}):null]})},z=function(e){return Object(P.jsx)(w.a,{component:"fieldset",children:Object(P.jsxs)(k.a,{children:[Object(P.jsx)(I.a,{component:"legend",children:e.configName}),Object(P.jsx)(p.a,{value:e.value,onChange:function(t){return e.onChange(t,t.target.value)},onBlur:e.onBlur,onFocus:e.onFocus,disabled:!e.onChange})]})})},U=function(e,t,n,a,c){if(e.hasOwnProperty(c)){var i=e[c];return i.configName===t&&i.optionName===n&&i.type===a}return!0},_=function(e){var t=e.configGroup,n=e.labels,c=e.setLabelGroup,i=e.onEnter,r=e.onShiftEnter,l=e.onCtrlEnter,s=e.onEsc,u=e.onDel,j=e.setConfigGroup,d=a.useMemo((function(){return function(e){return Object.entries(e.single).map((function(e){var t=Object(o.a)(e,2);return[t[0],t[1],"single"]})).concat(Object.entries(e.multiple).map((function(e){var t=Object(o.a)(e,2);return[t[0],t[1],"multiple"]}))).map((function(e){var t=Object(o.a)(e,3),n=t[0],a=t[1],c=t[2];return Object.entries(a.options).map((function(e){var t=Object(o.a)(e,2),a=t[0];return{key:t[1].shortcut,configName:n,optionName:a,type:c}}))})).flat().reduce((function(e,t){return e[t.key]={type:t.type,configName:t.configName,optionName:t.optionName},e}),{})}(t)}),[t]),h=a.useState(!1),f=Object(o.a)(h,2),g=f[0],m=f[1],p=a.useCallback((function(e,n,a){var c=Object(O.a)(Object(O.a)({},t),{},Object(b.a)({},n,Object(O.a)(Object(O.a)({},t[n]),{},Object(b.a)({},e,a))));j(c)}),[t,j]),v=a.useCallback((function(e,n){var a=Object(O.a)(Object(O.a)({},t),{},Object(b.a)({},n,Object(O.a)(Object(O.a)({},t[n]),{},Object(b.a)({},e,{id:null}))));"multiple"!==n&&"single"!==n||(a[n][e].options={}),j(a)}),[t,j]),y=a.useCallback((function(e,t,a){if(c){var i,r;if("single"===t||"text"===t)r="single"===t&&n[t][e]===a?null:a,i=Object(O.a)(Object(O.a)({},n),{},Object(b.a)({},t,Object(O.a)(Object(O.a)({},n[t]),{},Object(b.a)({},e,r))));else if("multiple"===t){var o=Object(x.a)(n[t][e]),l=o.indexOf(a);l>=0?o.splice(l,1):o.push(a),i=Object(O.a)(Object(O.a)({},n),{},Object(b.a)({},t,Object(O.a)(Object(O.a)({},n[t]),{},Object(b.a)({},e,o))))}c(i)}}),[n,c]);return a.useEffect((function(){var e=function(e){if(i||c||s||u)if(!d.hasOwnProperty(e.key)||e.ctrlKey||e.shiftKey||g)!i||"Enter"!==e.key||e.shiftKey||e.ctrlKey?r&&"Enter"===e.key&&e.shiftKey&&!e.ctrlKey?r():l&&"Enter"===e.key&&!e.shiftKey&&e.ctrlKey?l():s&&"Escape"===e.key?s():u&&"Delete"===e.key&&u():i();else{var t=d[e.key],n=t.type,a=t.configName,o=t.optionName;y(a,n,o)}};return document.addEventListener("keydown",e,!1),function(){document.removeEventListener("keydown",e,!1)}}),[i,c,d,g,y]),Object(P.jsxs)("div",{children:[e.setConfigGroup?Object(P.jsxs)("div",{children:[Object(P.jsx)(R,{addConfig:v,configGroup:t}),Object(P.jsx)(L.a,{style:{marginTop:"10px",marginBottom:"10px"}})," "]}):null,Object.entries(t.single).map((function(t){var n=Object(o.a)(t,2),a=n[0],i=n[1];return Object(P.jsx)(M,{config:i,onChange:c?function(e,t){return y(a,"single",t)}:null,setConfig:e.setConfigGroup?function(e,t){return p(e,"single",t)}:null,isShortcutValid:function(e,t){return U(d,a,e,"single",t)},configName:a,selected:e.labels?e.labels.single[a]:null},a)})),Object.entries(t.multiple).map((function(t){var n=Object(o.a)(t,2),a=n[0],i=n[1];return Object(P.jsx)(D,{config:i,onChange:c?function(e,t){return y(a,"multiple",t)}:null,setConfig:e.setConfigGroup?function(e,t){return p(e,"multiple",t)}:null,isShortcutValid:function(e,t){return U(d,a,e,"multiple",t)},configName:a,selected:e.labels?e.labels.multiple[a]:null},a)})),Object.entries(t.text).map((function(t){var n=Object(o.a)(t,2),a=n[0];n[1];return Object(P.jsx)(z,{onChange:c?function(e,t){return y(a,"text",t)}:null,onFocus:function(){m(!0),e.setTyping&&e.setTyping(!0)},onBlur:function(){m(!1),e.setTyping&&e.setTyping(!1)},configName:a,value:e.labels&&e.labels.text[a]||""},a)}))]})},K=n(201).a({startIcon:{position:"absolute",left:"8px"},label:{paddingLeft:"40px"}})(C.a),H=n(272),F=n(273),G=n(215),q=n(212),V=n(38),W=V.a((function(e){return{root:{"& a":{color:"white",textDecoration:"none"}}}})),Y=function(e){var t,n=e.project&&0!==e.project.nImages?Math.round(100*e.project.nLabeled/e.project.nImages):null,a=W();return Object(P.jsx)(H.a,{position:null!==(t=e.position)&&void 0!==t?t:"static",style:{zIndex:1201},children:Object(P.jsxs)(F.a,{children:[null!==n?Object(P.jsxs)(S.a,{position:"relative",display:"inline-flex",children:[Object(P.jsx)(G.a,{style:{color:"white"},variant:"determinate",size:40,color:"secondary",value:n}),Object(P.jsx)(S.a,{top:0,left:0,bottom:0,right:0,position:"absolute",display:"flex",alignItems:"center",justifyContent:"center",children:Object(P.jsx)(q.a,{variant:"caption",component:"div",style:{color:"white"},children:"".concat(n,"%")})})]}):null,Object(P.jsx)(q.a,{variant:"h6",style:{marginLeft:"10px"},className:a.root,children:e.children})]})})},J=n(80),Q=n(274),X=n(275),Z=n(267),$=n(276),ee=n(277),te=n(259),ne=n(260),ae=n(261),ce=n(262),ie=n(50),re=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_BACKEND_PORT?"http://".concat(window.location.hostname,":").concat(Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_BACKEND_PORT):"",oe=function(e){return{text:Object.entries(e.text).reduce((function(e,t){var n=Object(o.a)(t,2),a=n[0];n[1];return Object(O.a)(Object(O.a)({},e),{},Object(b.a)({},a,null))}),{}),multiple:Object.entries(e.multiple).reduce((function(e,t){var n=Object(o.a)(t,2),a=n[0];n[1];return Object(O.a)(Object(O.a)({},e),{},Object(b.a)({},a,[]))}),{}),single:Object.entries(e.single).reduce((function(e,t){var n=Object(o.a)(t,2),a=n[0];n[1];return Object(O.a)(Object(O.a)({},e),{},Object(b.a)({},a,null))}),{})}},le=function(e){return{image:oe(e.labelingConfiguration.image),boxes:[],default:!1,ignored:!1}},se=function(e){return Object.keys(e.box.single).length>0||Object.keys(e.box.multiple).length>0||Object.keys(e.box.text).length>0},ue={credentials:"include"},je={method:"POST",headers:{"Content-Type":"application/json"},credentials:"include"},be=function(){return fetch("".concat(re,"/api/v1/auth/config"),ue).then((function(e){return e.json()}))},de=function(){return fetch("".concat(re,"/api/v1/users/me"),ue).then((function(e){if(e.ok)return e;throw Error(e.statusText)})).then((function(e){return e.json()}))},he=function(e){return fetch("".concat(re,"/api/v1/projects/").concat(e),ue).then((function(e){return e.json()}))},fe=function(e){return fetch("".concat(re,"/api/v1/projects"),Object(O.a)(Object(O.a)({},je),{},{body:JSON.stringify(e)})).then((function(e){return e.json()}))},Oe=function(e,t){return fetch("".concat(re,"/api/v1/projects/").concat(e,"/images/").concat(t,"/labels"),ue).then((function(e){return e.json()}))},xe=function(e,t){return fetch("".concat(re,"/api/v1/projects/").concat(e,"/images/").concat(t),ue).then((function(e){return e.json()}))},ge=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],c=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,o=t.map((function(e){return"exclude=".concat(e)})).join("&"),l="".concat(re,"/api/v1/projects/").concat(e,"/images?shuffle=").concat(a,"&limit=").concat(n,"&exclude_ignored=").concat(c,"&max_labels=").concat(i,"&").concat(o);return r&&(l+="&page=".concat(r)),fetch(l,ue).then((function(e){return e.json()}))},me=function(e,t,n){return fetch("".concat(re,"/api/v1/projects/").concat(e,"/images/").concat(t,"/labels"),Object(O.a)(Object(O.a)({},je),{},{body:JSON.stringify(n)})).then((function(e){return e.json()}))},pe=function(e,t){return fetch("".concat(re,"/api/v1/projects/").concat(e,"/images/").concat(t,"/labels"),Object(O.a)(Object(O.a)({},ue),{},{method:"DELETE"})).then((function(e){return e.json()}))},ve=function(e,t){return"".concat(re,"/api/v1/projects/").concat(e,"/images/").concat(t,"/file")},ye=function(e){return"".concat(re,"/api/v1/projects/").concat(e,"/export")},Ce=function(e){return new Promise((function(t){return setTimeout(t,e)}))},Se=function(){var e=Object(f.a)(h.a.mark((function e(t){var n,a,c;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null===(n=t.current)||void 0===n||n.focus({preventScroll:!0}),e.next=3,Ce(200);case 3:null===(a=t.current)||void 0===a||a.blur(),null===(c=t.current)||void 0===c||c.click();case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ke=function(e){return Object.fromEntries(e.map((function(e){return[e.id,{selected:!0,remoteStatus:"unknown"}]})))},we=V.a((function(e){return{checkbox:{left:"50%",top:"50%",transform:"translate(-50%, -50%)"},checked:{color:"rgba(0, 150, 0, 1)"},unchecked:{color:"rgba(150, 0, 0, 1)"}}})),Be=function(e){var t=we(),n=function(n){return Object(P.jsx)(J.a,{className:"".concat(t.checkbox," ").concat(n.selected?t.checked:t.unchecked),onClick:function(){return e.toggleSelected(n.image.id)},"aria-label":"selected ".concat(n.image.id),children:n.selected?Object(P.jsx)(te.a,{}):Object(P.jsx)(ne.a,{})})};return Object(P.jsx)(Q.a,{rowHeight:e.thumbnailSize,cols:Math.ceil(800/e.thumbnailSize),children:e.items.map((function(t){return Object(P.jsxs)(X.a,{cols:1,children:[Object(P.jsx)("img",{style:{maxWidth:"100%",maxHeight:"100%",height:"100%",width:"100%",objectFit:"contain",transform:"none",margin:"auto",position:"absolute",top:0,bottom:0,left:0,right:0},src:ve(e.projectId,t.image.id),alt:"ID: ".concat(t.image.id),onClick:function(){return e.toggleSelected(t.image.id)}}),n(t)]},t.image.id)}))})},Ie=function(){var e=j.g().params,t=e.projectId,n=e.imageIds,c=a.useState({labels:null,dirty:!1,saved:[],batches:[],batchSize:10,thumbnailSize:160,redirecting:!1,advanceOnSave:!0,history:[],project:null,currentBatchStatus:{},currentBatch:[]}),i=Object(o.a)(c,2),r=i[0],l=i[1],s=a.useRef(),d=a.useRef(),x=a.useRef(),p=a.useRef(),v=a.useRef(),y=a.useRef(),k=a.useRef(),w=a.useCallback((function(){return r.history.filter((function(e){return e.images.map((function(e){return e.id})).join(",")!==n}))}),[r,n]),B=a.useCallback((function(e){var n,a,c=r.currentBatch.filter((function(e){return r.currentBatchStatus[e.id].selected}));switch(e){case"ignore":a="ignored",n=c.map((function(e){return me(t,e.id,Object(O.a)(Object(O.a)({},r.labels),{},{ignored:!0}))}));break;case"delete":a="unknown",n=c.map((function(e){return pe(t,e.id)}));break;case"save":a="labeled",n=c.map((function(e){return me(t,e.id,r.labels)}))}Promise.all(n).then((function(){var e=Object(O.a)(Object(O.a)({},r),{},{currentBatchStatus:Object(O.a)(Object(O.a)({},r.currentBatchStatus),Object.fromEntries(c.map((function(e){return[e.id,{selected:!1,remoteStatus:a}]}))))});l(e),r.advanceOnSave&&Object.entries(e.currentBatchStatus).filter((function(e){var t=Object(o.a)(e,2);t[0];return"unknown"!==t[1].remoteStatus})).length===e.currentBatch.length&&Se(d)}))}),[r,d]),I=a.useCallback((function(){var e=[{images:r.currentBatch,status:r.currentBatchStatus}].concat(w());l(Object(O.a)(Object(O.a)({},r),{},{currentBatch:r.batches[0],currentBatchStatus:ke(r.batches[0]),batches:r.batches.slice(1),history:e,redirecting:!0}))}),[r,w]),N=a.useCallback((function(){l(Object(O.a)(Object(O.a)({},r),{},{history:r.history.slice(1),currentBatch:r.history[0].images,currentBatchStatus:r.history[0].status,batches:[r.currentBatch].concat(r.batches),redirecting:!0}))}),[r]),A=a.useCallback((function(){return l(Object(O.a)(Object(O.a)({},r),{},{currentBatchStatus:ke(r.currentBatch)}))}),[r]),R=a.useCallback((function(){return l(Object(O.a)(Object(O.a)({},r),{},{currentBatchStatus:Object.fromEntries(Object.entries(r.currentBatchStatus).map((function(e){var t=Object(o.a)(e,2),n=t[0],a=t[1];return[n,Object(O.a)(Object(O.a)({},a),{},{selected:"unknown"===a.remoteStatus})]})))}))}),[r]),T=a.useCallback((function(){return l(Object(O.a)(Object(O.a)({},r),{},{currentBatchStatus:Object.fromEntries(Object.entries(r.currentBatchStatus).map((function(e){var t=Object(o.a)(e,2),n=t[0],a=t[1];return[n,Object(O.a)(Object(O.a)({},a),{},{selected:!1})]})))}))}),[r]);a.useEffect((function(){var e=n.split(",").map((function(e){return{id:e}})),a=ke(e),c=r.batches.length>0?Promise.resolve(r.batches):ge(t,e.map((function(e){return e.id})),r.batchSize,!0,!0,0).then((function(e){return Promise.resolve([e])}));Promise.all([he(t),Oe(t,e[0].id),c]).then((function(t){var n=Object(o.a)(t,3),c=n[0],i=n[1],s=n[2];return l(Object(O.a)(Object(O.a)({},r),{},{labels:i,batches:s,project:c,currentBatchStatus:a,currentBatch:e,redirecting:!1}))}))}),[t,n]),a.useEffect((function(){var e=function(){var e=Object(f.a)(h.a.mark((function e(t){var n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=null,e.t0=t.key,e.next="A"===e.t0?4:"a"===e.t0?6:"ArrowRight"===e.t0?8:"ArrowLeft"===e.t0?10:"Enter"===e.t0?12:"Backspace"===e.t0||"Delete"===e.t0?14:16;break;case 4:return n=t.ctrlKey&&t.shiftKey?k:null,e.abrupt("break",16);case 6:return n=t.ctrlKey&&!t.shiftKey?y:null,e.abrupt("break",16);case 8:return n=d,e.abrupt("break",16);case 10:return n=x,e.abrupt("break",16);case 12:return n=t.shiftKey?p:s,e.abrupt("break",16);case 14:return n=v,e.abrupt("break",16);case 16:n&&Se(n);case 17:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return document.addEventListener("keydown",e,!1),function(){document.removeEventListener("keydown",e,!1)}}),[r,d,x,s,p,v,y,k]);var M=null;if(r.redirecting){var D=r.currentBatch.map((function(e){return e.id})).join(",");D?D!==n&&(M=Object(P.jsx)(j.a,{to:"/projects/".concat(t,"/batches/").concat(D),push:!0})):M=Object(P.jsx)(j.a,{to:"/projects/".concat(t),push:!0})}if(!r.project||!r.labels)return null;var z=Object.entries(r.currentBatchStatus).reduce((function(e,t){var n=Object(o.a)(t,2);n[0];return e+("labeled"===n[1].remoteStatus?1:0)}),0),U=Object.entries(r.currentBatchStatus).reduce((function(e,t){var n=Object(o.a)(t,2);n[0];return e+("ignored"===n[1].remoteStatus?1:0)}),0),H=Object.entries(r.currentBatchStatus).reduce((function(e,t){var n=Object(o.a)(t,2);n[0];return e+(n[1].selected?1:0)}),0);return Object(P.jsxs)("div",{children:[Object(P.jsxs)(m.a,{container:!0,spacing:2,children:[Object(P.jsx)(m.a,{item:!0,xs:12,children:Object(P.jsxs)(Y,{project:r.project,children:[Object(P.jsx)(u.b,{to:"/",children:"QSL"})," /"," ",Object(P.jsx)(u.b,{to:"/projects/".concat(t),children:r.project.name})," ","/ Batches"]})}),Object(P.jsxs)(m.a,{item:!0,xs:3,children:[Object(P.jsxs)(m.a,{item:!0,children:[M,Object(P.jsx)(q.a,{style:{marginBottom:"10px"},variant:"h6",children:"Image-Level Labels"}),r.labels&&r.project?Object(P.jsx)(_,{configGroup:r.project.labelingConfiguration.image,labels:r.labels.image,setLabelGroup:function(e){return l(Object(O.a)(Object(O.a)({},r),{},{labels:{boxes:[],image:e,default:!1,ignored:!1}}))}}):null,Object(P.jsx)(L.a,{})]}),Object(P.jsxs)(m.a,{item:!0,children:[Object(P.jsx)(q.a,{variant:"h6",children:"View Settings"}),Object(P.jsx)(q.a,{id:"batch-size-selector",gutterBottom:!0,children:"Target Batch Size"}),Object(P.jsx)(Z.a,{value:r.batchSize,"aria-labelledby":"batch-size-selector",valueLabelDisplay:"auto",onChange:function(e,t){return l(Object(O.a)(Object(O.a)({},r),{},{batchSize:t}))},step:10,marks:!0,min:10,max:110}),Object(P.jsx)(q.a,{id:"batch-size-selector",gutterBottom:!0,children:"Thumbnail Size"}),Object(P.jsx)(Z.a,{value:r.thumbnailSize,"aria-labelledby":"batch-size-selector",valueLabelDisplay:"auto",onChange:function(e,t){return l(Object(O.a)(Object(O.a)({},r),{},{thumbnailSize:t}))},step:20,marks:!0,min:160,max:500}),Object(P.jsx)(L.a,{})]}),Object(P.jsxs)(m.a,{item:!0,children:[Object(P.jsx)(q.a,{style:{marginBottom:"10px"},variant:"h6",children:"Label Actions"}),Object(P.jsxs)($.a,{size:"small",orientation:"vertical",color:"primary",style:{width:"100%"},"aria-label":"acton button group",children:[Object(P.jsx)(K,{startIcon:"\u23ce",disabled:z+U===r.currentBatch.length||0===H,onClick:function(){return B("save")},ref:s,children:"Save"}),Object(P.jsx)(K,{startIcon:"\u21e7\u23ce",disabled:z+U===r.currentBatch.length||0===H,onClick:function(){return B("ignore")},ref:p,children:"Ignore"}),Object(P.jsx)(K,{startIcon:"\u232b",ref:v,disabled:z+U===r.currentBatch.length||0===H,onClick:function(){return B("delete")},children:"Remove Labels"}),Object(P.jsx)(K,{startIcon:Object(P.jsx)(ae.a,{}),ref:d,onClick:I,disabled:0===r.batches.length,children:"Next"}),Object(P.jsx)(K,{startIcon:Object(P.jsx)(ce.a,{}),onClick:N,ref:x,disabled:0===w().length,children:"Previous"}),Object(P.jsx)(K,{disabled:H===r.currentBatch.length-z,onClick:R,startIcon:"\u2303A",ref:y,children:"Select All"}),Object(P.jsx)(K,{startIcon:"\u2303\u21e7A",disabled:0===H,onClick:T,ref:k,children:"Select None"})]}),Object(P.jsx)(g.a,{control:Object(P.jsx)(E.a,{checked:r.advanceOnSave,onChange:function(e,t){return l(Object(O.a)(Object(O.a)({},r),{},{advanceOnSave:t}))},name:"advanceOnSave"}),label:"Advance when batch complete?"}),se(r.project.labelingConfiguration)?Object(P.jsx)(q.a,{variant:"body1",children:"This project has box-level labels which will be overwritten in batch mode."}):null]}),Object(P.jsxs)(m.a,{item:!0,children:[Object(P.jsx)(L.a,{style:{marginBottom:"10px"}}),Object(P.jsx)(q.a,{variant:"h6",children:"History"}),Object(P.jsx)(q.a,{variant:"caption",children:"Ten most recently reviewed batches."}),Object(P.jsx)(ie.a,{rows:r.history.map((function(e){return Object(O.a)(Object(O.a)({},e),{},{id:e.images.map((function(e){return e.id})).join(",")})})),hideFooterPagination:!0,disableColumnSelector:!0,disableSelectionOnClick:!0,disableColumnMenu:!0,hideFooter:!0,disableColumnReorder:!0,disableColumnFilter:!0,autoHeight:!0,columns:[{field:"images",headerName:"ID",flex:1,renderCell:function(e){var n=e.value.map((function(e){return e.id}));return Object(P.jsx)(u.b,{to:"/projects/".concat(t,"/images/").concat(n.join(",")),children:n.slice(0,5).join(", ")+(n.length>5?", ...":"")})}}]}),M,Object(P.jsx)(L.a,{style:{marginBottom:"10px"}}),Object(P.jsx)(ee.a,{component:u.b,variant:"body1",to:"/projects/".concat(t),children:"Return to Project Menu"})]})]}),Object(P.jsxs)(m.a,{item:!0,xs:9,children:[z+U<r.currentBatch.length?Object(P.jsxs)(S.a,{children:[Object(P.jsx)(Be,{items:r.currentBatch.filter((function(e){return"unknown"===r.currentBatchStatus[e.id].remoteStatus})).map((function(e){return{image:e,selected:r.currentBatchStatus[e.id].selected}})),thumbnailSize:r.thumbnailSize,projectId:t,toggleSelected:function(e){return l(Object(O.a)(Object(O.a)({},r),{},{currentBatchStatus:Object(O.a)(Object(O.a)({},r.currentBatchStatus),{},Object(b.a)({},e,Object(O.a)(Object(O.a)({},r.currentBatchStatus[e]),{},{selected:!r.currentBatchStatus[e].selected})))}))}}),Object(P.jsx)(L.a,{style:{marginBottom:"10px"}})]}):null,Object(P.jsxs)(m.a,{container:!0,direction:"row",alignItems:"center",spacing:1,children:[Object(P.jsx)(m.a,{item:!0,children:Object(P.jsx)(C.a,{onClick:A,disabled:0===z&&0===U,variant:"contained",children:"Reset"})}),Object(P.jsx)(m.a,{item:!0,children:Object(P.jsxs)(q.a,{variant:"body1",children:["Hiding ",z," labeled and ",U," ignored images."]})})]})]})]}),r.batches&&r.batches.length?r.batches.map((function(e,n){return e.map((function(e,n){return Object(P.jsx)("img",{alt:"Background Load: ".concat(e.id),src:ve(t,e.id),style:{width:0,height:0}},e.id)}))})):null]})},Ne=n(158),Ee=n(263),Le=n(268),Pe=n(278),Ae=n(264),Re=n(147),Te=n.n(Re),Me=function(e){return"".concat(100*e,"%")},De=function(e){var t=e.points&&e.points.length>0,n=t&&2===e.points.length&&e.points[0].x===e.points[1].x&&e.points[0].y===e.points[1].y?e.points.slice(0,1):e.points;return{x:t?null:Math.min(e.x1,e.x2),y:t?null:Math.min(e.y1,e.y2),w:t?null:Math.abs(e.x2-e.x1),h:t?null:Math.abs(e.y2-e.y1),id:e.id,labels:e.labels,points:n}},ze=function(e,t){var n=t.getBoundingClientRect(),a=n.x,c=n.y,i=n.width,r=n.height;return{x:(e.nativeEvent.pageX-window.scrollX-a)/i,y:(e.nativeEvent.pageY-window.scrollY-c)/r}},Ue=function(e){if(!e.draftBox&&!e.box)return null;var t=e.box&&null!==e.box.points||e.draftBox&&null!==e.draftBox.points;if(!t&&e.draftBox&&!(e.draftBox.x1&&e.draftBox.x2&&e.draftBox.y1&&e.draftBox.y2))return null;var n=e.draftBox?De(e.draftBox):e.box;if(t&&0===n.points.length)return null;var a=e.draftBox?"red":"blue",c=t?Math.min.apply(Math,n.points.map((function(e){return e.x}))):n.x,i=t?Math.min.apply(Math,n.points.map((function(e){return e.y}))):n.y,r=t?Math.max.apply(Math,n.points.map((function(e){return e.x}))):n.x+n.w,o=t?Math.max.apply(Math,n.points.map((function(e){return e.y}))):n.y+n.h,l=t?r-c:n.w,s=t?o-i:n.h,u=null;u=t&&l>0&&s>0?Object(P.jsx)("svg",{children:Array.from(Array(n.points.length-1).keys()).map((function(e){return Object(P.jsx)("line",{stroke:a,strokeWidth:"4",x1:Me((n.points[e].x-c)/l),y1:Me((n.points[e].y-i)/s),x2:Me((n.points[e+1].x-c)/l),y2:Me((n.points[e+1].y-i)/s)},e)}))}):t?Object(P.jsx)("rect",{transform:"translate(-5, -5)",width:10,height:10,fill:a}):Object(P.jsx)("rect",{width:"100%",height:"100%",stroke:a,fill:"none",strokeWidth:"4"});var j,b=null;if(e.draftBox&&e.draftBox.fixed&&!t&&null!==e.draftBox.next){var d=e.draftBox.y1>e.draftBox.y2,h=e.draftBox.x1>e.draftBox.x2,f=1===e.draftBox.next&&!d||2===e.draftBox.next&&d,O=1===e.draftBox.next&&!h||2===e.draftBox.next&&h;b=Object(P.jsx)("rect",{x:O?"0%":"100%",y:f?"0%":"100%",transform:"translate(-5, -5)",width:10,height:10,fill:"red"})}else e.draftBox&&t&&null!==e.draftBox.next&&l>0&&s>0&&(b=Object(P.jsx)("rect",{x:Me((n.points[0].x-c)/l),y:Me((n.points[0].y-i)/s),transform:"translate(-5, -5)",width:10,height:10,fill:"red"}));return Object(P.jsxs)("svg",{width:l>0?Me(l):10,height:s>0?Me(s):10,onClick:e.onClick,onMouseMove:e.onMouseMove,style:{position:"absolute",left:Me(c),top:Me(i),overflow:"visible"},children:[Object(P.jsx)("text",{x:5,y:5,fill:a,fontFamily:"Roboto,Helvetica,Arial,sans-serif",alignmentBaseline:"hanging",children:(j=n.labels,Object.values(j.single).filter((function(e){return null!==e})).concat(Object.values(j.text).filter((function(e){return null!==e}))).join(", "))}),u,b]})},_e=function(e){var t=j.g().params,n=t.projectId,c=t.imageId,i=a.useRef(),r=Te.a.debounce((function(t){e.onHover(ze(t,i.current))}),5),o=function(t){e.onClick&&e.onClick(ze(t,i.current))};return Object(P.jsx)("div",{children:Object(P.jsxs)("div",{style:{position:"relative",display:"inline-block",marginLeft:5,marginTop:5},children:[Object(P.jsx)(Ue,{onMouseMove:r,onClick:function(t){return e.onSelectBox(null,ze(t,i.current))},draftBox:e.draftBox}),Object(P.jsxs)(Ne.a,{children:[e.boxes.map((function(t,n){return Object(P.jsx)(Ue,{box:t,onMouseMove:r,onClick:function(t){return t.altKey?o(t):e.onSelectBox(n,ze(t,i.current))}},n)})),Object(P.jsx)("img",{onClick:o,onMouseMove:r,ref:i,src:ve(n,c),alt:"ID: ".concat(c),style:{display:"block",width:"".concat(512*e.zoom,"px")}})]})]})})},Ke=function(e){return e.length>0?e[0].id.toString():null},He=function(e,t,n){return[{id:e,status:t}].concat(n.filter((function(t){return t.id!==e}))).slice(0,10)},Fe=function(){var e=j.g().params,t=e.projectId,n=e.imageId,c=a.useRef(),i=a.useRef(),r=a.useRef(),l=a.useRef(),s=a.useRef(),b=a.useRef(),d=a.useRef(),x=a.useState(null),m=Object(o.a)(x,2),p=m[0],v=m[1],y=a.useState(null),C=Object(o.a)(y,2),k=C[0],B=C[1],N=a.useState({queueSize:20,desiredImageId:n,typing:!1,status:"initializing",usePolygon:!1,labels:null,filepath:null,advanceOnSave:!0,dirty:!1,notice:null,history:[],queue:[],unlabeledOnly:!0}),A=Object(o.a)(N,2),R=A[0],T=A[1],M=a.useState(1),D=Object(o.a)(M,2),z=D[0],U=D[1],H=p&&p.fixed,G=k?H?k.labelingConfiguration.box:k.labelingConfiguration.image:null,V=R.labels?H?p.labels:R.labels.image:null,W=a.useCallback((function(e){if(p)if(p&&null!==p.next){var t=p.points&&p.points.length>0,n=t?(a={x:e.x,y:e.y},c=p.points[0],Math.sqrt(Math.pow(a.y-c.y,2)+Math.pow(a.x-c.x,2))<.001?c:a):null;v(Object(O.a)(Object(O.a)({},p),{},{x1:t?null:1===p.next?e.x:p.x1,y1:t?null:1===p.next?e.y:p.y1,x2:t?null:2===p.next?e.x:p.x2,y2:t?null:2===p.next?e.y:p.y2,fixed:!0,next:1===p.next?2:1,points:t?p.points.concat([n]):null}))}else T(Object(O.a)(Object(O.a)({},R),{},{labels:Object(O.a)(Object(O.a)({},R.labels),{},{boxes:[De(p)].concat(R.labels.boxes),default:!1})})),v(null);else v({x1:R.usePolygon?null:e.x,y1:R.usePolygon?null:e.y,x2:null,y2:null,labels:oe(k.labelingConfiguration.box),id:null,fixed:!!R.usePolygon,points:R.usePolygon?[{x:e.x,y:e.y}]:null,next:2});var a,c}),[R,p,k]),Q=a.useCallback((function(e){!p||p.points||p.fixed||null===p.next||v(Object(O.a)(Object(O.a)({},p),{},{x2:e.x,y2:e.y}))}),[R,p]),X=a.useCallback((function(e,t){if(p)p&&null!==p.next?W(t):p&&null===p.next&&(T(Object(O.a)(Object(O.a)({},R),{},{labels:Object(O.a)(Object(O.a)({},R.labels),{},{boxes:[De(p)].concat(R.labels.boxes),default:!1})})),v(null));else{var n=R.labels.boxes.splice(e,1)[0];v({x1:(a=n).x,x2:a.x+a.w,y1:a.y,y2:a.y+a.h,labels:a.labels,id:a.id,next:null,fixed:!0,points:a.points}),T(Object(O.a)(Object(O.a)({},R),{},{labels:Object(O.a)(Object(O.a)({},R.labels),{},{boxes:R.labels.boxes,default:!1})}))}var a}),[R,p]);a.useEffect((function(){he(t).then(B)}),[t,n]),a.useEffect((function(){var e=R.queue.filter((function(e){return e.id.toString()!==n})),a=e.map((function(e){return e.id})).concat(n?[n]:[]);Promise.all([n?xe(t,n):Promise.resolve(null),R.queueSize<=e.length?Promise.resolve([]):ge(t,a,R.queueSize-e.length,!0,!!R.unlabeledOnly,R.unlabeledOnly?0:-1)]).then((function(t){var a=Object(o.a)(t,2),c=a[0],i=a[1],r=e.concat(i);T(Object(O.a)(Object(O.a)({},R),{},{labels:c.labels,filepath:c.filepath,queue:r,status:n?"waiting":"redirecting",desiredImageId:n||Ke(r)}))}))}),[n]);var ee=a.useCallback((function(){T(Object(O.a)(Object(O.a)({},R),{},{dirty:!0})),v(null)}),[R]),te=a.useCallback((function(){R.labels.default||pe(t,n).then((function(e){T(Object(O.a)(Object(O.a)({},R),{},{labels:e,dirty:!1,history:He(n,"Unlabeled",R.history),notice:"Deleted your label and reverted to default."}))}))}),[n,R]),ne=a.useCallback((function(){return T(Object(O.a)(Object(O.a)({},R),{},{notice:null}))}),[R]),re=a.useCallback((function(){me(t,n,Object(O.a)(Object(O.a)({},R.labels),{},{ignored:!1})).then(function(){var e=Object(f.a)(h.a.mark((function e(t){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:T(Object(O.a)(Object(O.a)({},R),{},{labels:t,dirty:!1,history:He(n,"Labeled",R.history),notice:"Saved your labels."})),R.advanceOnSave&&Se(c);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}),[R,c]),le=a.useCallback((function(){v(null),T(Object(O.a)(Object(O.a)({},R),{},{dirty:!0,labels:Object(O.a)(Object(O.a)({},R.labels),{},{boxes:R.labels.boxes.concat([De(p)])})}))}),[p,R]),ue=a.useCallback((function(){H||me(t,n,Object(O.a)(Object(O.a)({},R.labels),{},{ignored:!0})).then((function(e){T(Object(O.a)(Object(O.a)({},R),{},{labels:e,dirty:!1,history:He(n,"Ignored",R.history),notice:"Ignored this image."}))}))}),[R,H]),je=a.useCallback((function(){H||T(Object(O.a)(Object(O.a)({},R),{},{desiredImageId:Ke(R.queue),history:He(n,R.labels.ignored?"Ignored":R.labels.default?"Unlabeled":"Labeled",R.history),notice:"Advancing to next image.",status:"redirecting"}))}),[n,R.labels,R]),be=a.useCallback((function(){H||0===R.history.length||T(Object(O.a)(Object(O.a)({},R),{},{desiredImageId:R.history.length>0?R.history[0].id.toString():null,history:R.history.slice(1),queue:[{id:n}].concat(R.queue),status:"redirecting"}))}),[n,R]),de=a.useCallback((function(e){H?(v(Object(O.a)(Object(O.a)({},p),{},{labels:e})),T(Object(O.a)(Object(O.a)({},R),{},{dirty:!0}))):T(Object(O.a)(Object(O.a)({},R),{},{dirty:!0,labels:Object(O.a)(Object(O.a)({},R.labels),{},{image:e,default:!1})}))}),[R,p]);a.useEffect((function(){var e=function(){var e=Object(f.a)(h.a.mark((function e(t){var n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=null,e.t0=t.key,e.next="ArrowRight"===e.t0?4:"ArrowLeft"===e.t0?6:"Enter"===e.t0?8:"Backspace"===e.t0||"Delete"===e.t0?10:12;break;case 4:return n=c,e.abrupt("break",12);case 6:return n=i,e.abrupt("break",12);case 8:return n=H?b:t.shiftKey?l:r,e.abrupt("break",12);case 10:return n=H&&!R.typing?d:null,e.abrupt("break",12);case 12:n&&Se(n);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return document.addEventListener("keydown",e,!1),function(){document.removeEventListener("keydown",e,!1)}}),[R,H,b,d,c,i,r,l,s]);var fe="redirecting"===R.status?Object(P.jsx)(j.a,{to:R.desiredImageId?"/projects/".concat(t,"/images/").concat(R.desiredImageId):"/projects/".concat(t),push:!0}):null;if(!R.labels||!k)return fe;return Object(P.jsxs)("div",{style:{display:"flex"},children:[Object(P.jsx)(Ee.a,{}),Object(P.jsxs)(Y,{project:k,position:"fixed",children:[Object(P.jsx)(u.b,{to:"/",children:"QSL"})," /"," ",Object(P.jsx)(u.b,{to:"/projects/".concat(t),children:k.name})," / Images / ",R.filepath]}),Object(P.jsx)(Le.a,{variant:"permanent",style:{flexShrink:0},children:Object(P.jsxs)(S.a,{style:{padding:"15px",width:275,overflowY:"scroll"},children:[Object(P.jsx)(F.a,{}),fe,Object(P.jsx)(q.a,{style:{marginBottom:"10px"},variant:"h6",children:H?"Box-Level Labels":"Image-Level Labels"}),Object(P.jsx)(_,{configGroup:G,labels:V,setLabelGroup:de,setTyping:function(e){return T(Object(O.a)(Object(O.a)({},R),{},{typing:e}))}}),Object(P.jsx)(L.a,{style:{marginTop:"10px"}}),Object(P.jsx)(q.a,{variant:"h6",children:"View Settings"}),Object(P.jsxs)(w.a,{style:{margin:"10px 0px",width:"100%"},component:"fieldset",children:[Object(P.jsx)(I.a,{component:"legend",children:"Zoom"}),Object(P.jsx)(Z.a,{style:{margin:"0 5px"},valueLabelDisplay:"auto","aria-labelledby":"zoom-slider",value:z,min:.25,max:20,onChange:function(e,t){return U(t)}})]}),Object(P.jsx)(L.a,{}),Object(P.jsx)(q.a,{style:{marginBottom:"10px"},variant:"h6",children:"Label Actions"}),Object(P.jsxs)($.a,{size:"small",orientation:"vertical",color:"primary",style:{width:"100%"},"aria-label":"acton button group",children:[H?Object(P.jsx)(K,{startIcon:"\u23ce",onClick:le,ref:b,children:"Set Box Label"}):null,H?Object(P.jsx)(K,{startIcon:"\u232b",onClick:ee,ref:d,children:"Delete Box"}):null,H?null:Object(P.jsx)(K,{startIcon:"\u23ce",disabled:!R.labels.default&&!R.dirty,onClick:re,ref:r,children:"Save"}),H?null:Object(P.jsx)(K,{startIcon:"\u21e7\u23ce",disabled:R.labels.ignored,onClick:ue,ref:l,children:"Ignore"}),H?null:Object(P.jsx)(K,{startIcon:Object(P.jsx)(ae.a,{}),ref:c,onClick:je,children:"Next"}),H?null:Object(P.jsx)(K,{startIcon:Object(P.jsx)(ce.a,{}),onClick:be,ref:i,disabled:0===R.history.filter((function(e){return e.id!==n})).length,children:"Previous"}),H?null:Object(P.jsx)(K,{disabled:R.labels.default,ref:s,onClick:te,children:R.labels.ignored?"Unignore":"Remove Label"})]}),Object(P.jsx)(g.a,{control:Object(P.jsx)(E.a,{checked:R.advanceOnSave,onChange:function(e,t){return T(Object(O.a)(Object(O.a)({},R),{},{advanceOnSave:t}))},name:"advanceOnSave"}),label:"Advance on saving?"}),Object(P.jsx)(g.a,{control:Object(P.jsx)(E.a,{checked:R.usePolygon,onChange:function(e,t){return T(Object(O.a)(Object(O.a)({},R),{},{usePolygon:t}))},name:"usePolygon"}),label:"Use polygons instead of boxes?"}),Object(P.jsx)(g.a,{control:Object(P.jsx)(E.a,{checked:R.unlabeledOnly,onChange:function(e,t){return T(Object(O.a)(Object(O.a)({},R),{},{unlabeledOnly:t}))},name:"unlabeledOnly"}),label:"Show only unlabeled / unignored images?"}),Object(P.jsx)(L.a,{style:{marginBottom:"10px"}}),Object(P.jsx)(q.a,{variant:"h6",children:"History"}),Object(P.jsx)(q.a,{variant:"caption",children:"Ten most recently reviewed images."}),Object(P.jsx)(ie.a,{rows:R.history,hideFooterPagination:!0,disableColumnSelector:!0,disableSelectionOnClick:!0,disableColumnMenu:!0,hideFooter:!0,disableColumnReorder:!0,disableColumnFilter:!0,autoHeight:!0,columns:[{field:"id",headerName:"ID",flex:4,renderCell:function(e){return Object(P.jsx)(u.b,{to:"/projects/".concat(t,"/images/").concat(e.value),children:e.value})}},{field:"status",headerName:"Status",flex:3}]})]})}),Object(P.jsxs)("div",{style:{width:"calc(100%-".concat(275,"px"),marginLeft:275},children:[Object(P.jsx)(F.a,{}),Object(P.jsx)(_e,{onClick:se(k.labelingConfiguration)?W:null,onHover:Q,onSelectBox:X,boxes:R.labels.boxes,draftBox:p,zoom:z}),Object(P.jsx)(Pe.a,{anchorOrigin:{vertical:"bottom",horizontal:"left"},open:null!==R.notice,autoHideDuration:1500,onClose:ne,message:R.notice,action:Object(P.jsx)(a.Fragment,{children:Object(P.jsx)(J.a,{size:"small","aria-label":"close",color:"inherit",onClick:ne,children:Object(P.jsx)(Ae.a,{fontSize:"small"})})})}),R.queue&&R.queue.length?R.queue.map((function(e,n){return Object(P.jsx)("img",{alt:"Background Load: ".concat(e.id),src:ve(t,e.id),style:{width:0,height:0}},e.id)})):null]})]})},Ge=function(e){var t=j.g().params.projectId,n=a.useState(null),c=Object(o.a)(n,2),i=c[0],r=c[1],l=a.useState(!1),s=Object(o.a)(l,2),b=s[0],d=s[1],h=a.useState(!1),f=Object(o.a)(h,2),x=f[0],g=f[1],v=a.useState(!1),y=Object(o.a)(v,2),S=y[0],B=y[1],N=a.useCallback((function(){return function(e,t){return fetch("".concat(re,"/api/v1/projects/").concat(e),Object(O.a)(Object(O.a)({},je),{},{body:JSON.stringify(t)})).then((function(e){return e.json()}))}(t,i).then((function(e){r(e),d(!1),g(!0)}))}),[i,r]),E=a.useCallback((function(){he(t).then(r)}),[t]),L=a.useCallback((function(){(function(e){return fetch("".concat(re,"/api/v1/projects/").concat(e),Object(O.a)(Object(O.a)({},ue),{},{method:"DELETE"})).then((function(e){return e.json()}))})(i.id).then((function(){B(!0)}))}),[i]);return a.useEffect((function(){E()}),[t]),i?x?Object(P.jsx)(j.a,{to:"/projects/".concat(t)}):S?Object(P.jsx)(j.a,{to:"/projects"}):Object(P.jsxs)(m.a,{container:!0,spacing:2,children:[Object(P.jsx)(m.a,{item:!0,xs:12,children:Object(P.jsxs)(Y,{children:[Object(P.jsx)(u.b,{to:"/",children:"QSL"})," /"," ",Object(P.jsx)(u.b,{to:"/projects/".concat(t),children:i.name})," / Edit"]})}),Object(P.jsx)(m.a,{item:!0,xs:12,children:Object(P.jsx)(w.a,{component:"fieldset",children:Object(P.jsxs)(k.a,{children:[Object(P.jsx)(I.a,{component:"legend",children:"Project Name"}),Object(P.jsx)(p.a,{value:i.name,onChange:function(e){r(Object(O.a)(Object(O.a)({},i),{},{name:e.target.value})),d(!0)}})]})})}),Object(P.jsxs)(m.a,{item:!0,xs:12,sm:6,children:[Object(P.jsx)(q.a,{variant:"h6",children:"Image-Level Labels"}),Object(P.jsx)(_,{configGroup:i.labelingConfiguration.image,setConfigGroup:function(e){d(!0),r(Object(O.a)(Object(O.a)({},i),{},{labelingConfiguration:Object(O.a)(Object(O.a)({},i.labelingConfiguration),{},{image:e})}))}})]}),Object(P.jsxs)(m.a,{item:!0,sm:12,md:6,children:[Object(P.jsx)(q.a,{variant:"h6",children:"Box-Level Labels"}),Object(P.jsx)(_,{configGroup:i.labelingConfiguration.box,setConfigGroup:function(e){d(!0),r(Object(O.a)(Object(O.a)({},i),{},{labelingConfiguration:Object(O.a)(Object(O.a)({},i.labelingConfiguration),{},{box:e})}))}})]}),Object(P.jsxs)(m.a,{item:!0,container:!0,xs:12,spacing:2,children:[Object(P.jsx)(m.a,{item:!0,children:Object(P.jsx)(C.a,{onClick:N,variant:"contained",disabled:!b,color:"primary",children:"Save Changes"})}),Object(P.jsx)(m.a,{item:!0,children:Object(P.jsx)(C.a,{onClick:E,variant:"contained",disabled:!b,color:"secondary",children:"Reset"})}),e.allowDelete?Object(P.jsx)(m.a,{item:!0,children:Object(P.jsx)(C.a,{onClick:L,variant:"contained",color:"secondary",children:"Delete Project"})}):null]})]}):null},qe=n(148),Ve=n.n(qe),We=function(){var e=j.g().params.projectId,t=a.useState(null),n=Object(o.a)(t,2),c=n[0],i=n[1],r=a.useState([]),l=Object(o.a)(r,2),s=l[0],b=l[1],d=a.useState(null),h=Object(o.a)(d,2),f=h[0],x=h[1],g=a.useCallback((function(){return function(e,t,n){return fetch("".concat(re,"/api/v1/projects/").concat(e,"/images"),Object(O.a)(Object(O.a)({},je),{},{body:JSON.stringify({files:t,defaults:n})})).then((function(e){return e.json()}))}(e,s,f).then((function(){x(le(c)),b([])}))}),[c,s,f]);return a.useEffect((function(){he(e).then((function(e){x(le(e)),i(e)}))}),[]),c?Object(P.jsxs)(m.a,{container:!0,spacing:2,children:[Object(P.jsxs)(m.a,{item:!0,xs:12,children:[Object(P.jsx)(u.b,{to:"/projects/".concat(e),children:Object(P.jsx)(q.a,{variant:"subtitle1",children:"Back to project menu"})}),Object(P.jsx)(q.a,{variant:"h5",children:"Add Files to Project"})]}),Object(P.jsx)(m.a,{item:!0,xs:12,children:Object(P.jsx)(C.a,{onClick:g,disabled:0===s.length,style:{width:"100%"},variant:"contained",color:"primary",children:"Add Files"})}),Object(P.jsx)(m.a,{item:!0,xs:6,children:Object(P.jsx)(Ve.a,{label:"New Files",variant:"outlined",value:s,onPaste:function(e){e.preventDefault(),b(s.concat(e.clipboardData.getData("Text").split("\n").filter((function(e){return e.length>0}))))},onAdd:function(e){return b(s.concat([e]))},onDelete:function(e){return b(s.filter((function(t){return t!==e})))},fullWidth:!0})}),Object(P.jsxs)(m.a,{item:!0,xs:6,children:[Object(P.jsx)(q.a,{variant:"h6",children:"Defaults"}),Object(P.jsx)(_,{configGroup:c.labelingConfiguration.image,labels:f.image,setLabelGroup:function(e){return x(Object(O.a)(Object(O.a)({},f),{},{image:e}))}})]})]}):null},Ye=function(){var e=j.g().params.projectId,t=a.useState([]),n=Object(o.a)(t,2),c=n[0],i=n[1],r=a.useState(null),l=Object(o.a)(r,2),s=l[0],b=l[1],d=a.useState(0),h=Object(o.a)(d,2),f=h[0],O=h[1],x=a.useState([]),g=Object(o.a)(x,2),p=g[0],v=g[1],y=a.useState(!1),S=Object(o.a)(y,2),k=S[0],w=S[1];if(a.useEffect((function(){he(e).then(b)}),[]),a.useEffect((function(){ge(e,[],10,!1,!0,0).then(i)}),[e]),a.useEffect((function(){w(!0),ge(e,[],15,!1,!1,-1,f+1).then((function(e){v(e),w(!1)}))}),[e,f]),!s)return null;var B,I=(B=s.labelingConfiguration,Object.keys(B.box.single).length>0||Object.keys(B.box.multiple).length>0||Object.keys(B.box.text).length>0||Object.keys(B.image.single).length>0||Object.keys(B.image.multiple).length>0||Object.keys(B.image.text).length>0);return Object(P.jsxs)(m.a,{container:!0,spacing:2,children:[Object(P.jsx)(m.a,{item:!0,xs:12,children:Object(P.jsxs)(Y,{project:s,children:[Object(P.jsx)(u.b,{to:"/",children:"QSL"})," /"," ",Object(P.jsx)(u.b,{to:"/projects/".concat(e),children:s.name})]})}),Object(P.jsx)(m.a,{item:!0,children:Object(P.jsxs)("ul",{children:[I&&p.length>0?Object(P.jsx)("li",{children:c.length>0?Object(P.jsx)(u.b,{to:"/projects/".concat(e,"/images/").concat(c[0].id),children:Object(P.jsx)(q.a,{variant:"body1",children:"Start labeling individual images"})}):Object(P.jsx)(q.a,{variant:"body1",children:"No images remain for labeling."})}):null,I&&0!==p.length&&0!==c.length?Object(P.jsx)("li",{children:Object(P.jsx)(u.b,{to:"/projects/".concat(e,"/batches/").concat(c.map((function(e){return e.id})).join(",")),children:Object(P.jsx)(q.a,{variant:"body1",children:"Start labeling image batches"})})}):null,Object(P.jsx)("li",{children:Object(P.jsx)(u.b,{to:"/projects/".concat(e,"/edit-project"),children:Object(P.jsx)(q.a,{variant:"body1",children:I?"Edit project configuration":"Configure project"})})}),Object(P.jsx)("li",{children:Object(P.jsx)("a",{href:ye(e),children:Object(P.jsx)(q.a,{variant:"body1",children:"Export project"})})})]})}),Object(P.jsx)(m.a,{item:!0,xs:12,children:Object(P.jsx)(ie.a,{rows:p,autoHeight:!0,disableColumnSelector:!0,disableSelectionOnClick:!0,disableColumnMenu:!0,disableColumnFilter:!0,columns:[{field:"id",headerName:"ID",flex:3,disableColumnMenu:!0,renderCell:function(t){return Object(P.jsx)(u.b,{to:"/projects/".concat(e,"/images/").concat(t.value),children:t.value})}},{field:"filepath",headerName:"Path",flex:4},{field:"nLabels",headerName:"# Labels",flex:1},{field:"status",headerName:"Status",renderCell:function(e){return Object(P.jsx)("span",{style:{textTransform:"capitalize"},children:e.value})},flex:1}],pagination:!0,pageSize:15,rowsPerPageOptions:[15],rowCount:s.nImages,paginationMode:"server",onPageChange:function(e){return O(e.page)},loading:k})}),Object(P.jsx)(m.a,{item:!0,children:Object(P.jsx)(C.a,{component:u.b,to:"/projects/".concat(e,"/add-images"),variant:"contained",color:"primary",disabled:!I,children:"Add Images"})})]})},Je=function(){var e=a.useState(""),t=Object(o.a)(e,2),n=t[0],c=t[1],i=a.useState([]),r=Object(o.a)(i,2),l=r[0],s=r[1];a.useEffect((function(){fetch("".concat(re,"/api/v1/projects"),ue).then((function(e){return e.json()})).then(s)}),[]);var j=a.useCallback((function(){fe({name:n,id:null,labelingConfiguration:null}).then((function(e){s(l.concat([e])),c("")}))}),[n,l,s]),b=a.useCallback((function(e){he(e.id).then((function(t){return fe(Object(O.a)(Object(O.a)({},t),{},{name:"".concat(e.name," (Duplicate)")}))})).then((function(e){return s(l.concat([e]))}))}),[l,s]);return Object(P.jsxs)(m.a,{container:!0,spacing:2,children:[Object(P.jsx)(m.a,{item:!0,xs:12,children:Object(P.jsx)(ie.a,{rows:l,disableColumnSelector:!0,disableSelectionOnClick:!0,disableColumnMenu:!0,disableColumnFilter:!0,autoHeight:!0,columns:[{field:"id",headerName:"ID",flex:1,renderCell:function(e){return Object(P.jsx)(u.b,{to:"/projects/".concat(e.value),children:e.value})}},{field:"name",headerName:"Name",flex:3},{field:"nImages",headerName:"Number of Images",flex:1},{field:"nLabeled",headerName:"Labeled Images",flex:1},{field:"Actions",renderCell:function(e){return Object(P.jsxs)("div",{children:[Object(P.jsx)(C.a,{variant:"outlined",component:u.b,to:"/projects/".concat(e.row.id,"/edit-project"),style:{marginRight:"10px"},children:"Edit"}),Object(P.jsx)(C.a,{variant:"outlined",onClick:function(){return b(e.row)},children:"Duplicate"})]})},flex:2}]})}),Object(P.jsx)(m.a,{item:!0,xs:12,children:Object(P.jsxs)(S.a,{children:[Object(P.jsx)(p.a,{value:n,placeholder:"New project name",onChange:function(e){return c(e.target.value)},style:{marginRight:"10px"}}),Object(P.jsx)(C.a,{variant:"contained",color:"primary",disabled:""===n,onClick:j,children:"Create Project"})]})})]})},Qe=function(){var e=a.useState({newUserName:"",users:[],myUser:null,authConfig:null,newUserAdmin:!1}),t=Object(o.a)(e,2),n=t[0],c=t[1];a.useEffect((function(){Promise.all([de(),fetch("".concat(re,"/api/v1/users"),ue).then((function(e){return e.json()})),be()]).then((function(e){var t=Object(o.a)(e,3),a=t[0],i=t[1],r=t[2];c(Object(O.a)(Object(O.a)({},n),{},{myUser:a,users:i,authConfig:r}))}))}),[]);var i=a.useCallback((function(){var e;(e={name:n.newUserName,isAdmin:n.newUserAdmin,id:null},fetch("".concat(re,"/api/v1/users"),Object(O.a)(Object(O.a)({},je),{},{body:JSON.stringify(e)})).then((function(e){return e.json()}))).then((function(e){c(Object(O.a)(Object(O.a)({},n),{},{newUserName:"",users:n.users.concat([e])}))}))}),[n]);return n.myUser&&n.authConfig?Object(P.jsxs)(m.a,{container:!0,spacing:2,children:[Object(P.jsx)(m.a,{item:!0,xs:12,children:Object(P.jsxs)(q.a,{variant:"body1",children:["github"===n.authConfig.provider?"You are using GitHub as the authentication provider. Usernames should match GitHub usernames.":null,"google"===n.authConfig.provider?"You are using Google as the authentication provider. Usernames should match email addresses.":null,null===n.authConfig.provider?"You are not using an authentication provider. You will always be logged in as the first user.":null]})}),Object(P.jsx)(m.a,{item:!0,xs:12,children:Object(P.jsx)(ie.a,{rows:n.users,autoHeight:!0,columns:[{field:"id",headerName:"ID",flex:1,disableColumnMenu:!0},{field:"name",headerName:"Name",flex:5,disableColumnMenu:!0},{field:"isAdmin",headerName:"Adminstrator",flex:2,valueFormatter:function(e){return e.value?"Yes":"No"},disableColumnMenu:!0}]})}),Object(P.jsx)(m.a,{item:!0,xs:12,children:n.myUser.isAdmin?Object(P.jsxs)(m.a,{container:!0,direction:"row",children:[Object(P.jsx)(p.a,{value:n.newUserName,onChange:function(e){return c(Object(O.a)(Object(O.a)({},n),{},{newUserName:e.target.value}))},placeholder:"New user name"}),Object(P.jsx)(g.a,{control:Object(P.jsx)(E.a,{checked:n.newUserAdmin,onChange:function(e,t){return c(Object(O.a)(Object(O.a)({},n),{},{newUserAdmin:t}))},name:"makeAdmin"}),label:"Administrator"}),Object(P.jsx)(C.a,{disabled:""===n.newUserName,onClick:i,children:"Create User"})]}):null})]}):null},Xe=function(){return Object(P.jsxs)(m.a,{container:!0,spacing:2,children:[Object(P.jsx)(m.a,{item:!0,xs:12,children:Object(P.jsx)(Y,{children:Object(P.jsx)(u.b,{to:"/",children:"QSL"})})}),Object(P.jsxs)(m.a,{item:!0,xs:12,children:[Object(P.jsx)(q.a,{style:{marginTop:"10px",marginBottom:"10px"},variant:"h4",children:"Projects"}),Object(P.jsx)(Je,{}),Object(P.jsx)(q.a,{style:{marginTop:"20px",marginBottom:"10px"},variant:"h4",children:"Users"}),Object(P.jsx)(Qe,{})]})]})},Ze=l.a({components:{MuiImageListItem:{styleOverrides:{img:{maxWidth:"100%",maxHeight:"100%",height:"auto",width:"auto",transform:"none",margin:"auto",position:"absolute",top:0,bottom:0,left:0,right:0}}}}}),$e=function(){var e=a.useState({user:void 0,config:void 0}),t=Object(o.a)(e,2),n=t[0],c=t[1];return a.useEffect((function(){Promise.all([de(),be()]).then((function(e){var t=Object(o.a)(e,2),n=t[0],a=t[1];return c({user:n,config:a})}),(function(){c({user:null,config:null})}))}),[]),void 0===n.user?null:null===n.user?(window.location.href="".concat(re,"/auth/login"),null):Object(P.jsx)(s.a,{theme:Ze,children:Object(P.jsx)(u.a,{children:Object(P.jsxs)(j.d,{children:[Object(P.jsx)(j.b,{path:"/projects/:projectId/images/:imageId",children:Object(P.jsx)(Fe,{})}),Object(P.jsx)(j.b,{path:"/projects/:projectId/batches/:imageIds",children:Object(P.jsx)(Ie,{})}),Object(P.jsx)(j.b,{path:"/projects/:projectId/edit-project",children:Object(P.jsx)(Ge,{allowDelete:null===n.config.singleProject})}),Object(P.jsx)(j.b,{path:"/projects/:projectId/add-images",children:Object(P.jsx)(We,{})}),Object(P.jsx)(j.b,{path:"/projects/:projectId",children:Object(P.jsx)(Ye,{})}),Object(P.jsx)(j.b,{path:"/projects",children:null!==n.config.singleProject?Object(P.jsx)(j.a,{to:"/projects/".concat(n.config.singleProject)}):Object(P.jsx)(Xe,{})}),Object(P.jsx)(j.b,{path:"/users",children:null!==n.config.singleProject?Object(P.jsx)(j.a,{to:"/projects/".concat(n.config.singleProject)}):Object(P.jsx)(Xe,{})}),Object(P.jsx)(j.b,{path:"/",children:null!==n.config.singleProject?Object(P.jsx)(j.a,{to:"/projects/".concat(n.config.singleProject)}):Object(P.jsx)(Xe,{})})]})})})};n(196);r.a.render(Object(P.jsx)(c.a.StrictMode,{children:Object(P.jsx)($e,{})}),document.getElementById("root"))}},[[197,1,2]]]);
//# sourceMappingURL=main.a651082e.chunk.js.map