[tox]
envlist = py37, py38, py39, py310, py37mpi, py38mpi, py39mpi, py310mpi
isolated_build = True

[testenv]
passenv = *
changedir = tests
deps = numba>0.54
       chardet
       numpy
       tinydb
       tqdm
       click
       pytest
       scitrack
       pandas
       plotly
       pytest-cov
       py{37mpi,38mpi,39mpi,310mpi}: mpi4py

[testenv:py310]
basepython = python3.10
commands =
    pytest -x --junitxml=junit-{envname}.xml --cov-report xml --cov=cogent3 ./ --ignore=test_app_mpi.py

[testenv:py39]
basepython = python3.9
commands =
    pytest -x --junitxml=junit-{envname}.xml --cov-report xml --cov=cogent3 ./ --ignore=test_app_mpi.py

[testenv:py38]
basepython = python3.8
commands =
    pytest -x --junitxml=junit-{envname}.xml --cov-report xml --cov=cogent3 ./ --ignore=test_app_mpi.py

[testenv:py37]
basepython = python3.7
commands =
    pytest -x --junitxml=junit-{envname}.xml --cov-report xml --cov=cogent3 ./ --ignore=test_app_mpi.py

[testenv:py37mpi]
basepython = python3.7
whitelist_externals = mpiexec
commands =
    mpiexec -n 1 {envpython} -m mpi4py.futures -m pytest -x --junitxml=junit-{envname}.xml --cov-report xml --cov=cogent3 test_app/test_app_mpi.py

[testenv:py38mpi]
basepython = python3.8
whitelist_externals = mpiexec
commands =
    mpiexec -n 1 {envpython} -m mpi4py.futures -m pytest -x --junitxml=junit-{envname}.xml --cov-report xml --cov=cogent3 test_app/test_app_mpi.py

[testenv:py39mpi]
basepython = python3.9
whitelist_externals = mpiexec
commands =
    mpiexec -n 1 {envpython} -m mpi4py.futures -m pytest -x --junitxml=junit-{envname}.xml --cov-report xml --cov=cogent3 test_app/test_app_mpi.py

[testenv:py10mpi]
basepython = python3.10
whitelist_externals = mpiexec
commands =
    mpiexec -n 1 {envpython} -m mpi4py.futures -m pytest -x --junitxml=junit-{envname}.xml --cov-report xml --cov=cogent3 test_app/test_app_mpi.py

[gh-actions]
python =
    3.7: py37
    3.8: py38
    3.9: py39
    3.10: py310
