"use strict";(self.webpackChunkimage_editor=self.webpackChunkimage_editor||[]).push([[94],{94:(e,t,a)=>{a.r(t),a.d(t,{default:()=>I});var o=a(633),n=a(321),r=a(93),i=a(979),l=a(706),c=a(797),d=a(809),p=a.n(d);class s extends l.Widget{constructor(e,t,a,o,n){super({node:document.createElement("div")}),this._ready=new c.PromiseDelegate,this.context=e,this.node.appendChild(document.createElement("div")).className="tui-image-editor",this._loadImageEditor(t,a,o,n),e.ready.then((async t=>{var a;await this.ready.promise;const o=await fetch(`data:image/${null===(a=e.contentsModel)||void 0===a?void 0:a.type};base64,${e.model.toString()}`),n=await o.blob();this.setContent(URL.createObjectURL(n),e.path)})),this._ready.resolve(void 0)}get ready(){return this._ready}applyRotate(e){"clock"===e?this._editor.rotate(30):this._editor.rotate(-30),this.updateModel()}crop(){this._editor.startDrawingMode("CROPPER")}async applyCrop(){await this._editor.crop(this._editor.getCropzoneRect()),this._editor.stopDrawingMode(),function(){const e=document.querySelector(".tui-image-editor"),t=document.querySelector(".tui-image-editor-canvas-container").style.maxHeight;e.style.height=t}(),this.updateModel()}cancelCrop(){this._editor.stopDrawingMode()}filter(e,t){this._editor.applyFilter(e,t),this.updateModel()}flip(e){"X"===e?this._editor.flipX():"Y"===e?this._editor.flipY():this._editor.resetFlip(),this.updateModel()}draw(e,t){const a={width:12,color:(o=t,.5,"rgba("+parseInt(o.slice(1,3),16)+","+parseInt(o.slice(3,5),16)+","+parseInt(o.slice(5,7),16)+",0.5)")};var o;this._editor.stopDrawingMode(),"freeDrawing"===e?this._editor.startDrawingMode("FREE_DRAWING",a):"straightLine"===e&&this._editor.startDrawingMode("LINE_DRAWING",a),this.updateModel()}clear(){this._editor.clearObjects()}updateModel(){requestAnimationFrame((()=>{const e=this._editor.toDataURL().replace(/^data:image\/\w+;base64,/g,"");this.context.model.fromString(e)}))}_loadImageEditor(e,t,a,o){this._editor=new(p())(this.node.querySelector(".tui-image-editor"),{cssMaxWidth:e,cssMaxHeight:t,selectionStyle:{cornerSize:a,rotatingPointOffset:o}})}setContent(e,t){void 0!==this._editor&&this._editor.toDataURL()!==e&&e.length&&this._editor.loadImageFromURL(e,t)}}class m extends i.ABCWidgetFactory{createNewWidget(e){return new i.DocumentWidget({context:e,content:new s(e,700,500,20,70)})}}const u=new c.Token("image-editor/tracki"),g=new r.LabIcon({name:"image-editor:brush",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" height="16px" viewBox="0 0 24 24" width="16px">\n    <path d="M0 0h24v24H0z" fill="none" />\n    <path class="jp-icon3" fill="black"\n        d="M7 14c-1.66 0-3 1.34-3 3 0 1.31-1.16 2-2 2 .92 1.22 2.49 2 4 2 2.21 0 4-1.79 4-4 0-1.66-1.34-3-3-3zm13.71-9.37l-1.34-1.34c-.39-.39-1.02-.39-1.41 0L9 12.25 11.75 15l8.96-8.96c.39-.39.39-1.02 0-1.41z" />\n</svg>'});var h,y=a(763),C=a(271),w=a.n(C);class b extends n.ReactWidget{constructor(e,t){super(),this._commands=e,this._docRegistry=t,this._operation=null}get operation(){return this._operation}set operation(e){this._operation=e,this.update()}onBeforeShow(e){super.onBeforeShow(e),this.update()}render(){return this.isAttached&&this.isVisible?w().createElement(E,{commands:this._commands,docRegistry:this._docRegistry,operation:this.operation,setOperation:e=>{this.operation=e}}):null}}function E(e){const[t,a]=(0,C.useState)("#000000"),[o,n]=(0,C.useState)(null),r=()=>{e.commands.execute("image-editor:apply-crop"),e.setOperation(null),e.commands.execute("application:toggle-left-area")},i=()=>{e.commands.execute("image-editor:cancel-crop"),e.setOperation(null),e.commands.execute("application:toggle-left-area")},l=(t,a)=>{e.commands.execute("image-editor:apply-filter",{type:t,options:a})},c=t=>{e.commands.execute("image-editor:apply-flip",{type:t})},d=t=>{e.commands.execute("image-editor:apply-rotate",{type:t})},p=(t,a)=>{null!==t&&(n(t),e.commands.execute("image-editor:apply-draw",{type:t,color:a}))},s=()=>{e.commands.execute("image-editor:apply-clear")};let m=null;switch(e.operation){case h.Crop:m=[w().createElement(y.Button,{appearance:"accent",onClick:r},"Apply"),w().createElement(y.Button,{appearance:"neutral",onClick:i},"Cancel")];break;case h.Filter:m=[w().createElement(y.Button,{appearance:"neutral",onClick:()=>l("Grayscale",null)},"Grayscale"),w().createElement(y.Button,{appearance:"neutral",onClick:()=>l("Invert",null)},"Invert"),w().createElement(y.Button,{appearance:"neutral",onClick:()=>l("Sepia",null)},"Sepia"),w().createElement(y.Button,{appearance:"neutral",onClick:()=>l("vintage",null)},"Sepia2"),w().createElement(y.Button,{appearance:"neutral",onClick:()=>l("Blur",{blur:.1})},"Blur"),w().createElement(y.Button,{appearance:"neutral",onClick:()=>l("Sharpen",null)},"Sharpen"),w().createElement(y.Button,{appearance:"neutral",onClick:()=>l("Emboss",null)},"Emboss")];break;case h.Flip:m=[w().createElement(y.Button,{appearance:"neutral",onClick:()=>c("X")},"FlipX"),w().createElement(y.Button,{appearance:"neutral",onClick:()=>c("Y")},"FlipY"),w().createElement(y.Button,{appearance:"neutral",onClick:()=>c("reset")},"Reset")];break;case h.Rotate:m=[w().createElement(y.Button,{appearance:"neutral",onClick:()=>d("clock")},"Clockwise"),w().createElement(y.Button,{appearance:"neutral",onClick:()=>d("counter")},"Counter-Clockwise")];break;case h.Draw:m=[w().createElement(y.Button,{appearance:"freeDrawing"===o?"accent":"neutral",onClick:()=>p("freeDrawing",t)},"Free Drawing"),w().createElement(y.Button,{appearance:"straightLine"===o?"accent":"neutral",onClick:()=>p("straightLine",t)},"Straight Line"),w().createElement("label",{className:"pickColor"},"Pick Color",w().createElement("input",{type:"color",value:t,onChange:e=>{a(e.target.value),p(o,e.target.value)}}))];break;case h.Clear:m=w().createElement(y.Button,{appearance:"neutral",onClick:s},"Clear");break;default:m="No advanced options to show."}return w().createElement("div",{className:"jp-ImageEditorPanel"},m)}!function(e){e[e.Crop=0]="Crop",e[e.Filter=1]="Filter",e[e.Flip=2]="Flip",e[e.Rotate=3]="Rotate",e[e.Draw=4]="Draw",e[e.Clear=5]="Clear"}(h||(h={}));var v=a(138);const f="ImageEditor";var F;!function(e){e.crop="image-editor:crop",e.applyCrop="image-editor:apply-crop",e.cancelCrop="image-editor:cancel-crop",e.openRotate="image-editor:open-rotate",e.applyRotate="image-editor:apply-rotate",e.openFilter="image-editor:open-filter",e.applyFilter="image-editor:apply-filter",e.openFlip="image-editor:open-flip",e.applyFlip="image-editor:apply-flip",e.openDraw="image-editor:open-draw",e.applyDraw="image-editor:apply-draw",e.applyClear="image-editor:apply-clear"}(F||(F={}));const I={id:"image-editor:plugin",autoStart:!0,optional:[o.ILayoutRestorer,n.ICommandPalette],provides:u,activate:function(e,t,a){const o="image-editor",i=new n.WidgetTracker({namespace:o});(0,v.addJupyterLabThemeChangeListener)(),t&&t.restore(i,{command:"docmanager:open",args:e=>({path:e.context.path,factory:f}),name:e=>e.context.path});const l=new m({name:f,modelName:"base64",fileTypes:["png","jpg","jpeg"],defaultFor:["png","jpg","jpeg"],toolbarFactory:()=>[{name:F.crop,widget:new n.CommandToolbarButton({commands:e.commands,id:F.crop,args:{toolbar:!0}})},{name:F.openRotate,widget:new n.CommandToolbarButton({commands:e.commands,id:F.openRotate,args:{toolbar:!0}})},{name:"docmanager:save-as",widget:new n.CommandToolbarButton({commands:e.commands,id:"docmanager:save-as",args:{toolbar:!0}})},{name:F.openFilter,widget:new n.CommandToolbarButton({commands:e.commands,id:F.openFilter,args:{toolbar:!0}})},{name:F.openFlip,widget:new n.CommandToolbarButton({commands:e.commands,id:F.openFlip,args:{toolbar:!0}})},{name:F.openDraw,widget:new n.CommandToolbarButton({commands:e.commands,id:F.openDraw,args:{toolbar:!0}})},{name:F.applyClear,widget:new n.CommandToolbarButton({commands:e.commands,id:F.applyClear,args:{toolbar:!0}})}]});l.widgetCreated.connect(((t,a)=>{const o=e.docRegistry.getFileTypesForPath(a.context.path);o.length>0&&(a.title.icon=o[0].icon),a.context.pathChanged.connect((()=>{i.save(a)})),i.add(a)})),e.docRegistry.addWidgetFactory(l),e.commands.addCommand(F.openRotate,{label:e=>(null==e?void 0:e.toolbar)?"Rotate":"Open Rotate",icon:r.refreshIcon,execute:()=>{i.currentWidget&&(c.operation=h.Rotate,e.shell.activateById(c.id))}}),e.commands.addCommand(F.applyRotate,{label:e=>(null==e||e.toolbar,"Apply Rotate"),icon:r.refreshIcon,execute:e=>{const t=i.currentWidget;t&&t.content.applyRotate(e.type)}}),e.commands.addCommand(F.crop,{label:e=>(null==e||e.toolbar,"Crop"),execute:()=>{const t=i.currentWidget;t&&(c.operation=h.Crop,e.shell.activateById(c.id),t.content.crop())}}),e.commands.addCommand(F.openFilter,{label:e=>(null==e||e.toolbar,"Filter"),execute:()=>{i.currentWidget&&(c.operation=h.Filter,e.shell.activateById(c.id))}}),e.commands.addCommand(F.applyFilter,{label:e=>(null==e||e.toolbar,"Apply Filter"),execute:e=>{const t=i.currentWidget;t&&t.content.filter(e.type,e.options)}}),e.commands.addCommand(F.openFlip,{label:e=>(null==e||e.toolbar,"Flip"),execute:()=>{i.currentWidget&&(c.operation=h.Flip,e.shell.activateById(c.id))}}),e.commands.addCommand(F.applyFlip,{label:e=>(null==e||e.toolbar,"Apply Flip"),execute:e=>{const t=i.currentWidget;t&&t.content.flip(e.type)}}),e.commands.addCommand(F.openDraw,{label:e=>(null==e||e.toolbar,"Draw"),execute:()=>{i.currentWidget&&(c.operation=h.Draw,e.shell.activateById(c.id))}}),e.commands.addCommand(F.applyDraw,{label:e=>(null==e||e.toolbar,"Apply Draw"),execute:e=>{const t=i.currentWidget;t&&t.content.draw(e.type,e.color)}}),e.commands.addCommand(F.applyClear,{label:e=>(null==e?void 0:e.toolbar)?"Clear":"Apply Clear",execute:e=>{const t=i.currentWidget;t&&t.content.clear()}}),e.commands.addCommand(F.applyCrop,{label:e=>(null==e?void 0:e.toolbar)?"Apply":"Apply Crop",execute:async()=>{const e=i.currentWidget;e&&await e.content.applyCrop()}}),e.commands.addCommand(F.cancelCrop,{label:e=>(null==e?void 0:e.toolbar)?"Cancel":"Cancel Crop",execute:()=>{const e=i.currentWidget;e&&e.content.cancelCrop()}}),a&&(a.addItem({command:F.openRotate,category:"Image Editor Operations"}),a.addItem({command:F.crop,category:"Image Editor Operations"}),a.addItem({command:F.applyCrop,category:"Image Editor Operations"}),a.addItem({command:F.cancelCrop,category:"Image Editor Operations"}),a.addItem({command:F.openFilter,category:"Image Editor Operations"}),a.addItem({command:F.openFlip,category:"Image Editor Operations"}),a.addItem({command:F.openDraw,category:"Image Editor Operations"}),a.addItem({command:F.applyClear,category:"Image Editor Operations"}));const c=new b(e.commands,e.docRegistry);return c.id="imageEditorPanel",c.title.icon=g,c.title.caption="Image Editor Panel",t&&t.add(c,o),e.shell.add(c,"left",{rank:1e3}),i}}}}]);